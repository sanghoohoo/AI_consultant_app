# AI ì…ì‹œ ìƒë‹´ ì±—ë´‡ ë°±ì—”ë“œ - ì „ì²´ í•¨ìˆ˜ ë¬¸ì„œ

> **í”„ë¡œì íŠ¸**: AI ê¸°ë°˜ í•œêµ­ ëŒ€í•™ ì…í•™ ìƒë‹´ ì±—ë´‡ ë°±ì—”ë“œ ì‹œìŠ¤í…œ
> **ê¸°ìˆ  ìŠ¤íƒ**: FastAPI, Supabase (PostgreSQL + pgvector), OpenAI GPT-4o-mini, Google Gemini AI, Azure Document Intelligence
> **ì‘ì„±ì¼**: 2025ë…„

---

## ëª©ì°¨

1. [í•µì‹¬ ì±—ë´‡ ì‹œìŠ¤í…œ](#1-í•µì‹¬-ì±—ë´‡-ì‹œìŠ¤í…œ)
2. [í˜ë¥´ì†Œë‚˜ ì‹œìŠ¤í…œ](#2-í˜ë¥´ì†Œë‚˜-ì‹œìŠ¤í…œ)
3. [ìºì‹± ì‹œìŠ¤í…œ](#3-ìºì‹±-ì‹œìŠ¤í…œ)
4. [ë³´ì•ˆ í•„í„°ë§](#4-ë³´ì•ˆ-í•„í„°ë§)
5. [ëŒ€í•™ëª… ì •ê·œí™”](#5-ëŒ€í•™ëª…-ì •ê·œí™”)
6. [ìƒê¸°ë¶€ ì²˜ë¦¬ ì‹œìŠ¤í…œ](#6-ìƒê¸°ë¶€-ì²˜ë¦¬-ì‹œìŠ¤í…œ)
7. [API ë¼ìš°íŠ¸](#7-api-ë¼ìš°íŠ¸)
8. [ë°ì´í„°ë² ì´ìŠ¤ í•¸ë“¤ëŸ¬](#8-ë°ì´í„°ë² ì´ìŠ¤-í•¸ë“¤ëŸ¬)
9. [ê³µìœ  ìœ í‹¸ë¦¬í‹°](#9-ê³µìœ -ìœ í‹¸ë¦¬í‹°)
10. [ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤](#10-ìœ í‹¸ë¦¬í‹°-í•¨ìˆ˜ë“¤)
11. [ìŠ¤í¬ë¦½íŠ¸](#11-ìŠ¤í¬ë¦½íŠ¸)

---

## 1. í•µì‹¬ ì±—ë´‡ ì‹œìŠ¤í…œ

### ğŸ“ main.py (1,200+ lines)

**íŒŒì¼ ëª©ì **: FastAPI ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ - RAG ê¸°ë°˜ AI ìƒë‹´ ì±—ë´‡ ì—”ë“œí¬ì¸íŠ¸

#### ì£¼ìš” í•¨ìˆ˜

##### `app = FastAPI(...)`
- **ìš”ì•½**: FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° CORS ì„¤ì •
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. FastAPI ì•± ì´ˆê¸°í™”
  2. CORS ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€ (í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™)
  3. Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”

##### `supabase = create_client(...)`
- **ìš”ì•½**: Supabase ë°ì´í„°ë² ì´ìŠ¤ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ëª¨ë“  í…Œì´ë¸” ì ‘ê·¼ ê°€ëŠ¥
- **ì›Œí¬í”Œë¡œìš°**:
  1. í™˜ê²½ ë³€ìˆ˜ì—ì„œ SUPABASE_URL, SUPABASE_ANON_KEY ë¡œë“œ
  2. create_client()ë¡œ ì—°ê²° ìƒì„±

##### `openai_client = OpenAI(...)`
- **ìš”ì•½**: OpenAI API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” (ì„ë² ë”© ë° GPT-4o-mini ì‚¬ìš©)
- **DB í…Œì´ë¸”**: ì—†ìŒ

##### `@app.on_event("startup")`
- **ìš”ì•½**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- **DB í…Œì´ë¸”**: user_profile (ì—°ê²° í…ŒìŠ¤íŠ¸ìš©)
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ì‹¤í–‰
  2. ì—°ê²° ì„±ê³µ ì‹œ ë¡œê·¸ ì¶œë ¥

##### `generate_embedding(text: str) -> List[float]`
- **ìš”ì•½**: í…ìŠ¤íŠ¸ë¥¼ OpenAI text-embedding-3-small ëª¨ë¸ë¡œ ë²¡í„°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ (ìˆœìˆ˜ ê³„ì‚°)
- **ì›Œí¬í”Œë¡œìš°**:
  1. OpenAI embeddings API í˜¸ì¶œ
  2. 1536ì°¨ì› ë²¡í„° ë°˜í™˜

##### `hierarchical_similarity_search(...)`
- **ìš”ì•½**: 3ë‹¨ê³„ ê³„ì¸µì  ìœ ì‚¬ë„ ê²€ìƒ‰ (admissions â†’ text_embeddings â†’ term_embeddings)
- **DB í…Œì´ë¸”**: admissions, text_embeddings, term_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. **1ë‹¨ê³„**: admissions í…Œì´ë¸”ì—ì„œ match_admission_by_embedding RPC í˜¸ì¶œ (ì¼ë°˜ì „í˜•, ìˆ˜ì‹œ)
  2. **2ë‹¨ê³„**: text_embeddings í…Œì´ë¸” ê²€ìƒ‰ (ê°€ì´ë“œ, ì •ì±… ë¬¸ì„œ)
  3. **3ë‹¨ê³„**: term_embeddings í…Œì´ë¸” ê²€ìƒ‰ (ìš©ì–´ ì •ì˜)
  4. ëª¨ë“  ê²°ê³¼ë¥¼ ìœ ì‚¬ë„ ìˆœìœ¼ë¡œ ì •ë ¬ í›„ ìƒìœ„ Nê°œ ë°˜í™˜

##### `process_chatbot_question_with_tool_use(...)`
- **ìš”ì•½**: Gemini AI Tool Use íŒ¨í„´ìœ¼ë¡œ ì±—ë´‡ ì§ˆë¬¸ ì²˜ë¦¬ (RAG ê²€ìƒ‰ ìë™ íŒë‹¨)
- **DB í…Œì´ë¸”**: chat_sessions, chat_turns, user_qa_cache, admissions, text_embeddings, term_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‚¬ìš©ì í”„ë¡œí•„ ë° í˜ë¥´ì†Œë‚˜ íŠ¹ì„± ì¡°íšŒ
  2. Gemini AIì— Tool Use ê°€ëŠ¥ í”„ë¡¬í”„íŠ¸ ì „ë‹¬
  3. AIê°€ search_database tool í˜¸ì¶œ ì—¬ë¶€ ê²°ì •
  4. Tool í˜¸ì¶œ ì‹œ: ê³„ì¸µì  RAG ê²€ìƒ‰ ì‹¤í–‰
  5. ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ìµœì¢… ë‹µë³€ ìƒì„±
  6. ë‹µë³€ì„ chat_turns í…Œì´ë¸”ì— ì €ì¥
  7. ìºì‹œ ì‹œìŠ¤í…œì— QA ìŒ ì €ì¥
  8. ë°±ê·¸ë¼ìš´ë“œì—ì„œ í˜ë¥´ì†Œë‚˜ ì—…ë°ì´íŠ¸

##### `@app.websocket("/chat/{user_id}")`
- **ìš”ì•½**: WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ ì±„íŒ… ì—”ë“œí¬ì¸íŠ¸
- **DB í…Œì´ë¸”**: chat_sessions, chat_turns, user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. WebSocket ì—°ê²° ìˆ˜ë½
  2. ì±„íŒ… ì„¸ì…˜ ID ìƒì„± ë˜ëŠ” ì¡°íšŒ
  3. ì‚¬ìš©ì ë©”ì‹œì§€ ìˆ˜ì‹  â†’ process_chatbot_question_with_tool_use í˜¸ì¶œ
  4. AI ë‹µë³€ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡
  5. ì—°ê²° ì¢…ë£Œ ì‹œ ì„¸ì…˜ ì¢…ë£Œ ì‹œê°„ ì—…ë°ì´íŠ¸

##### `@app.post("/persona/generate")`
- **ìš”ì•½**: ìƒê¸°ë¶€ ë°ì´í„° ê¸°ë°˜ í•™ìƒ í˜ë¥´ì†Œë‚˜ ìƒì„± API
- **DB í…Œì´ë¸”**: student_basic_info, student_subjects, student_grade_averages, persona_characteristics
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‚¬ìš©ì IDë¡œ ìƒê¸°ë¶€ ë°ì´í„° ì¡°íšŒ
  2. SengibuPersonaGenerator í˜¸ì¶œ
  3. í•™ì—… ì„±í–¥, ê´€ì‹¬ ë¶„ì•¼, ì„±ê²© íŠ¹ì„± ë¶„ì„
  4. persona_characteristics í…Œì´ë¸”ì— ì €ì¥

##### `@app.post("/persona/simulate")`
- **ìš”ì•½**: í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ í•™ìƒ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜ (í…ŒìŠ¤íŠ¸ìš©)
- **DB í…Œì´ë¸”**: persona_characteristics, student_basic_info
- **ì›Œí¬í”Œë¡œìš°**:
  1. PersonaSimulationLLM ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  2. load_persona_data()ë¡œ í•™ìƒ ë°ì´í„° ë¡œë“œ
  3. generate_response()ë¡œ ì‹œë®¬ë ˆì´ì…˜ ë‹µë³€ ìƒì„±

##### `update_persona_async(user_id, turn_summary)`
- **ìš”ì•½**: ì±„íŒ… ê¸°ë¡ì„ ë¶„ì„í•˜ì—¬ í˜ë¥´ì†Œë‚˜ ì ì§„ì  ì—…ë°ì´íŠ¸ (ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬)
- **DB í…Œì´ë¸”**: chat_turns, persona_characteristics
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìµœê·¼ ì±„íŒ… í„´ ìš”ì•½ ë¶„ì„
  2. ChatPersonaGeneratorë¡œ ìƒˆë¡œìš´ íŠ¹ì„± ì¶”ì¶œ
  3. ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ì™€ ë³‘í•©í•˜ì—¬ ì—…ë°ì´íŠ¸

##### `summarize_and_save_turn(user_id, user_question, ai_answer)`
- **ìš”ì•½**: ì±„íŒ… í„´ì„ ìš”ì•½í•˜ì—¬ ì €ì¥ (í˜ë¥´ì†Œë‚˜ ì—…ë°ì´íŠ¸ìš©)
- **DB í…Œì´ë¸”**: chat_turns
- **ì›Œí¬í”Œë¡œìš°**:
  1. GPT-4o-minië¡œ ëŒ€í™” ìš”ì•½ ìƒì„±
  2. ìš”ì•½ì„ summary ì»¬ëŸ¼ì— ì €ì¥

---

### ğŸ“ gemini_prompts.py (850+ lines)

**íŒŒì¼ ëª©ì **: Gemini AIìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì¤‘ì•™ ê´€ë¦¬

#### ì£¼ìš” í•¨ìˆ˜

##### `create_tool_use_prompt(...)`
- **ìš”ì•½**: Gemini Tool Use íŒ¨í„´ì˜ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„± (ì±—ë´‡ ë‹¤íšŒì°¨ ëŒ€í™”ìš©)
- **DB í…Œì´ë¸”**: ì—†ìŒ (í”„ë¡¬í”„íŠ¸ ìƒì„±ë§Œ)
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‚¬ìš©ì í˜ë¥´ì†Œë‚˜, í”„ë¡œí•„, ëŒ€í™” íˆìŠ¤í† ë¦¬ ì…ë ¥
  2. í•œêµ­ ëŒ€í•™ ì…ì‹œ ìƒë‹´ì‚¬ ì—­í•  í”„ë¡¬í”„íŠ¸ êµ¬ì„±
  3. search_database tool ì •ì˜ í¬í•¨
  4. ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ í¬í•¨í•˜ì—¬ í”„ë¡¬í”„íŠ¸ ë°˜í™˜

##### `create_persona_generation_prompt(sengibu_data)`
- **ìš”ì•½**: ìƒê¸°ë¶€ ë°ì´í„°ë¡œë¶€í„° í•™ìƒ í˜ë¥´ì†Œë‚˜ ìƒì„± í”„ë¡¬í”„íŠ¸
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìƒê¸°ë¶€ ì„¹ì…˜ë“¤(êµê³¼, ë¹„êµê³¼, í–‰ë™íŠ¹ì„± ë“±) ì…ë ¥
  2. í•™ì—… ì„±í–¥, ê´€ì‹¬ ë¶„ì•¼, ì„±ê²©, ì»¤ë¦¬ì–´ ëª©í‘œ ë¶„ì„ ìš”ì²­
  3. êµ¬ì¡°í™”ëœ JSON í˜•ì‹ ì‘ë‹µ ìš”ì²­

##### `create_chat_persona_generation_prompt(chat_history)`
- **ìš”ì•½**: ì±„íŒ… ê¸°ë¡ ë¶„ì„ì„ í†µí•œ í˜ë¥´ì†Œë‚˜ ì¶”ì¶œ í”„ë¡¬í”„íŠ¸
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ëŒ€í™” ë‚´ì—­ ì…ë ¥
  2. í•™ìƒì˜ ê´€ì‹¬ì‚¬, ì§„ë¡œ ê³ ë¯¼, ì„±ê²© íŠ¹ì„± ì¶”ì¶œ ìš”ì²­
  3. ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ì™€ ë³‘í•© ê°€ëŠ¥í•œ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜

##### `create_persona_merge_prompt(old_persona, new_traits)`
- **ìš”ì•½**: ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ì™€ ì‹ ê·œ íŠ¹ì„± ë³‘í•© í”„ë¡¬í”„íŠ¸
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ JSONê³¼ ì‹ ê·œ íŠ¹ì„± ì…ë ¥
  2. ì¤‘ë³µ ì œê±°, ì¶©ëŒ í•´ê²° ìš”ì²­
  3. ì—…ë°ì´íŠ¸ëœ í˜ë¥´ì†Œë‚˜ JSON ë°˜í™˜

##### `create_conversation_summary_prompt(conversation)`
- **ìš”ì•½**: ëŒ€í™” ë‚´ìš© ìš”ì•½ í”„ë¡¬í”„íŠ¸ (ì±„íŒ… ì„¸ì…˜ ìš”ì•½ìš©)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì „ì²´ ëŒ€í™” ì…ë ¥
  2. 3~5ë¬¸ì¥ ìš”ì•½ ìš”ì²­
  3. ì£¼ìš” ì§ˆë¬¸ê³¼ ë‹µë³€ í•˜ì´ë¼ì´íŠ¸

---

## 2. í˜ë¥´ì†Œë‚˜ ì‹œìŠ¤í…œ

### ğŸ“ persona_system/chat_persona_generator.py (410+ lines)

**íŒŒì¼ ëª©ì **: ì±„íŒ… ê¸°ë¡ ë¶„ì„ì„ í†µí•œ í•™ìƒ í˜ë¥´ì†Œë‚˜ ì¶”ì¶œ ë° ì—…ë°ì´íŠ¸

#### ì£¼ìš” í•¨ìˆ˜

##### `ChatPersonaGenerator.__init__()`
- **ìš”ì•½**: í˜ë¥´ì†Œë‚˜ ìƒì„±ê¸° ì´ˆê¸°í™” (OpenAI í´ë¼ì´ì–¸íŠ¸, Supabase ì—°ê²°)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. í™˜ê²½ ë³€ìˆ˜ì—ì„œ API í‚¤ ë¡œë“œ
  2. OpenAI, Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”

##### `generate_persona_from_chat(user_id, limit=20)`
- **ìš”ì•½**: ìµœê·¼ ì±„íŒ… ê¸°ë¡ì„ ë¶„ì„í•˜ì—¬ í˜ë¥´ì†Œë‚˜ íŠ¹ì„± ì¶”ì¶œ
- **DB í…Œì´ë¸”**: chat_turns, persona_characteristics
- **ì›Œí¬í”Œë¡œìš°**:
  1. user_idë¡œ ìµœê·¼ Nê°œ ëŒ€í™” ì¡°íšŒ
  2. GPT-4o-miniì— í˜ë¥´ì†Œë‚˜ ë¶„ì„ í”„ë¡¬í”„íŠ¸ ì „ë‹¬
  3. JSON ì‘ë‹µ íŒŒì‹± (interests, career_goals, personality_traits)
  4. _categorize_characteristics()ë¡œ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
  5. save_persona_to_db()ë¡œ ì €ì¥

##### `_categorize_characteristics(raw_persona)`
- **ìš”ì•½**: ì¶”ì¶œëœ í˜ë¥´ì†Œë‚˜ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë¶„ë¥˜ (ê´€ì‹¬ì‚¬, ì§„ë¡œ, ì„±ê²©, í•™ì—… ìŠ¤íƒ€ì¼)
- **DB í…Œì´ë¸”**: ì—†ìŒ (ìˆœìˆ˜ ë°ì´í„° ë³€í™˜)
- **ì›Œí¬í”Œë¡œìš°**:
  1. raw_persona JSON íŒŒì‹±
  2. interests, career_goals, personality_traits ì¶”ì¶œ
  3. ê° í•­ëª©ì— ì¹´í…Œê³ ë¦¬ íƒœê·¸ ë¶€ì—¬

##### `save_persona_to_db(user_id, persona_data)`
- **ìš”ì•½**: í˜ë¥´ì†Œë‚˜ íŠ¹ì„±ë“¤ì„ persona_characteristics í…Œì´ë¸”ì— ì €ì¥
- **DB í…Œì´ë¸”**: persona_characteristics
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ ì¡°íšŒ
  2. ì‹ ê·œ íŠ¹ì„±ê³¼ ë³‘í•© (ì¤‘ë³µ ì œê±°)
  3. UPSERT ë°©ì‹ìœ¼ë¡œ ì €ì¥

##### `merge_persona_data(old_persona, new_traits)`
- **ìš”ì•½**: ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ì™€ ìƒˆ íŠ¹ì„± ë³‘í•© (ì¤‘ë³µ ì œê±°, ìš°ì„ ìˆœìœ„ ì²˜ë¦¬)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì¹´í…Œê³ ë¦¬ë³„ë¡œ íŠ¹ì„± ë¹„êµ
  2. ì¤‘ë³µ í•­ëª© ì œê±°
  3. ìµœì‹  íŠ¹ì„± ìš°ì„  ì ìš©

---

### ğŸ“ persona_system/generative_persona_creator.py (530+ lines)

**íŒŒì¼ ëª©ì **: Gemini AIë¥¼ í™œìš©í•œ í’ë¶€í•œ í•™ìƒ í˜ë¥´ì†Œë‚˜ ìƒì„±

#### ì£¼ìš” í•¨ìˆ˜

##### `GenerativePersonaCreator.__init__()`
- **ìš”ì•½**: ìƒì„±í˜• í˜ë¥´ì†Œë‚˜ ìƒì„±ê¸° ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Google Generative AI ì„¤ì •
  2. gemini-2.0-flash-exp ëª¨ë¸ ë¡œë“œ

##### `create_comprehensive_persona(user_id)`
- **ìš”ì•½**: ìƒê¸°ë¶€ + ì±„íŒ… ë°ì´í„° ê¸°ë°˜ ì¢…í•© í˜ë¥´ì†Œë‚˜ ìƒì„±
- **DB í…Œì´ë¸”**: student_basic_info, student_subjects, student_career_hopes, chat_turns, persona_characteristics
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìƒê¸°ë¶€ ë°ì´í„° ì¡°íšŒ
  2. ì±„íŒ… ê¸°ë¡ ì¡°íšŒ
  3. _generate_initial_persona() í˜¸ì¶œ
  4. _generate_derived_characteristics() í˜¸ì¶œ
  5. ë‘ ê²°ê³¼ë¥¼ ë³‘í•©í•˜ì—¬ ì €ì¥

##### `_generate_initial_persona(sengibu_data)`
- **ìš”ì•½**: ìƒê¸°ë¶€ ë°ì´í„° ê¸°ë°˜ ì´ˆê¸° í˜ë¥´ì†Œë‚˜ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìƒê¸°ë¶€ JSONì„ Geminiì— ì „ë‹¬
  2. í•™ì—… ì„±í–¥, ê´€ì‹¬ ë¶„ì•¼, ì„±ê²© íŠ¹ì„± ë¶„ì„
  3. êµ¬ì¡°í™”ëœ JSON ì‘ë‹µ íŒŒì‹±

##### `_generate_derived_characteristics(initial_persona, chat_data)`
- **ìš”ì•½**: ì´ˆê¸° í˜ë¥´ì†Œë‚˜ + ì±„íŒ… ê¸°ë¡ìœ¼ë¡œ 2ì°¨ íŠ¹ì„± ë„ì¶œ
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì´ˆê¸° í˜ë¥´ì†Œë‚˜ì™€ ì±„íŒ… ê¸°ë¡ ê²°í•©
  2. Geminiì— ì‹¬í™” ë¶„ì„ ìš”ì²­
  3. ì¶”ê°€ íŠ¹ì„± (í•™ìŠµ ìŠ¤íƒ€ì¼, ë™ê¸°ë¶€ì—¬ ìš”ì¸ ë“±) ì¶”ì¶œ

---

### ğŸ“ persona_system/chatbot_persona_dialogue_engine.py (680+ lines)

**íŒŒì¼ ëª©ì **: í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ê°œì¸í™” ëŒ€í™” ì—”ì§„

#### ì£¼ìš” í•¨ìˆ˜

##### `ChatbotPersonaDialogueEngine.__init__()`
- **ìš”ì•½**: í˜ë¥´ì†Œë‚˜ ëŒ€í™” ì—”ì§„ ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Gemini AI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
  2. Supabase ì—°ê²°

##### `process_question(user_id, question, conversation_history=[])`
- **ìš”ì•½**: í˜ë¥´ì†Œë‚˜ë¥¼ ê³ ë ¤í•œ ê°œì¸í™” ë‹µë³€ ìƒì„±
- **DB í…Œì´ë¸”**: persona_characteristics, user_profile, chat_turns
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‚¬ìš©ì í˜ë¥´ì†Œë‚˜ ì¡°íšŒ
  2. _select_relevant_persona_traits() í˜¸ì¶œ (ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ íŠ¹ì„±ë§Œ ì„ íƒ)
  3. ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
  4. Geminiì— ê°œì¸í™” í”„ë¡¬í”„íŠ¸ ì „ë‹¬
  5. ë‹µë³€ ìƒì„± í›„ ë°˜í™˜

##### `_build_dialogue_context(user_id, conversation_history)`
- **ìš”ì•½**: ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± (ì´ì „ ëŒ€í™” + í˜ë¥´ì†Œë‚˜)
- **DB í…Œì´ë¸”**: chat_turns
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìµœê·¼ ëŒ€í™” ì´ë ¥ ì¡°íšŒ
  2. í˜ë¥´ì†Œë‚˜ íŠ¹ì„± ì¶”ê°€
  3. ì»¨í…ìŠ¤íŠ¸ ë¬¸ìì—´ ìƒì„±

##### `_select_relevant_persona_traits(question, all_traits)`
- **ìš”ì•½**: ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ í˜ë¥´ì†Œë‚˜ íŠ¹ì„±ë§Œ í•„í„°ë§ (í† í° ì ˆì•½)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì§ˆë¬¸ í‚¤ì›Œë“œ ì¶”ì¶œ
  2. í˜ë¥´ì†Œë‚˜ íŠ¹ì„±ê³¼ ë§¤ì¹­
  3. ê´€ë ¨ì„± ë†’ì€ íŠ¹ì„± ì„ íƒ

---

### ğŸ“ persona_system/persona_simulation_llm.py (583 lines)

**íŒŒì¼ ëª©ì **: í•™ìƒ í˜ë¥´ì†Œë‚˜ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬ ì±—ë´‡ í…ŒìŠ¤íŠ¸ìš© í•™ìƒ ì—­í•  ìˆ˜í–‰

#### ì£¼ìš” í•¨ìˆ˜

##### `PersonaSimulationLLM.__init__(supabase, openai_client, user_id)`
- **ìš”ì•½**: í˜ë¥´ì†Œë‚˜ ì‹œë®¬ë ˆì´í„° ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase, OpenAI í´ë¼ì´ì–¸íŠ¸ ì €ì¥
  2. user_id ì €ì¥

##### `load_persona_data()`
- **ìš”ì•½**: ì‚¬ìš©ìì˜ í˜ë¥´ì†Œë‚˜ ë° í•™ì—… ë°ì´í„° ë¡œë“œ
- **DB í…Œì´ë¸”**: persona_characteristics, student_basic_info, student_career_hopes, student_grade_averages
- **ì›Œí¬í”Œë¡œìš°**:
  1. persona_characteristics ì¡°íšŒ
  2. student_basic_info ì¡°íšŒ
  3. student_career_hopes ì¡°íšŒ
  4. student_grade_averages ì¡°íšŒ
  5. ëª¨ë“  ë°ì´í„°ë¥¼ dictë¡œ ë³‘í•©

##### `generate_response(chatbot_message, conversation_history=[])`
- **ìš”ì•½**: ì±—ë´‡ ë©”ì‹œì§€ì— ëŒ€í•œ í•™ìƒ ì—­í•  ì‘ë‹µ ìƒì„±
- **DB í…Œì´ë¸”**: chat_turns (ì €ì¥ìš©)
- **ì›Œí¬í”Œë¡œìš°**:
  1. í˜ë¥´ì†Œë‚˜ ë°ì´í„° í¬í•¨ í”„ë¡¬í”„íŠ¸ ìƒì„±
  2. GPT-4o-miniì— í•™ìƒ ì—­í•  ì§€ì‹œ
  3. í˜ë¥´ì†Œë‚˜ì— ë§ëŠ” ì‘ë‹µ ìƒì„±
  4. ì‘ë‹µì„ chat_turnsì— ì €ì¥

##### `generate_initial_question()`
- **ìš”ì•½**: í•™ìƒì´ ë¨¼ì € ì‹œì‘í•  ì§ˆë¬¸ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì´ˆê¸° ì§ˆë¬¸ ìƒì„± í”„ë¡¬í”„íŠ¸
  2. GPT-4o-mini í˜¸ì¶œ
  3. í˜ë¥´ì†Œë‚˜ì— ë§ëŠ” ì§ˆë¬¸ ë°˜í™˜

---

### ğŸ“ persona_system/sengibu_persona_generator.py (594 lines)

**íŒŒì¼ ëª©ì **: ìƒê¸°ë¶€(í•™êµìƒí™œê¸°ë¡ë¶€) ë°ì´í„° ë¶„ì„ì„ í†µí•œ í˜ë¥´ì†Œë‚˜ ìƒì„±

#### ì£¼ìš” í•¨ìˆ˜

##### `SengibuPersonaGenerator.__init__()`
- **ìš”ì•½**: ìƒê¸°ë¶€ í˜ë¥´ì†Œë‚˜ ìƒì„±ê¸° ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Gemini AI ì´ˆê¸°í™”
  2. Supabase ì—°ê²°

##### `generate_persona_from_sengibu(user_id)`
- **ìš”ì•½**: ìƒê¸°ë¶€ ì „ì²´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ í˜ë¥´ì†Œë‚˜ ìƒì„±
- **DB í…Œì´ë¸”**: student_basic_info, student_attendance, student_awards, student_certifications, student_career_hopes, student_creative_activities, student_reading_activities, student_behavior_opinions, student_subjects, student_grade_averages, persona_characteristics
- **ì›Œí¬í”Œë¡œìš°**:
  1. ëª¨ë“  ìƒê¸°ë¶€ í…Œì´ë¸” ì¡°íšŒ
  2. ì¹´í…Œê³ ë¦¬ë³„ ìš”ì•½ ìƒì„± (_summarize_category)
  3. êµê³¼ ì„±ì  í†µê³„ ê³„ì‚° (_compute_subjects_metrics)
  4. Geminiì— ì¢…í•© í˜ë¥´ì†Œë‚˜ ë¶„ì„ ìš”ì²­
  5. persona_characteristics í…Œì´ë¸”ì— ì €ì¥
  6. ë§ˆí¬ë‹¤ìš´ ìš”ì•½ íŒŒì¼ ìƒì„± (inspected_data/ í´ë”)

##### `_summarize_category(category_name, data)`
- **ìš”ì•½**: ìƒê¸°ë¶€ ê° ì„¹ì…˜ì„ LLMìœ¼ë¡œ ìš”ì•½
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ Geminiì— ì „ë‹¬
  2. 3~5ë¬¸ì¥ ìš”ì•½ ìš”ì²­
  3. í•µì‹¬ íŠ¹ì§• ì¶”ì¶œ

##### `_compute_subjects_metrics(subjects_data)`
- **ìš”ì•½**: êµê³¼ ì„±ì  ë°ì´í„°ì˜ í†µê³„ ì§€í‘œ ê³„ì‚° (z-score, ë°±ë¶„ìœ„)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì›ì ìˆ˜, í‰ê· , í‘œì¤€í¸ì°¨ë¡œ z-score ê³„ì‚°
  2. ë°±ë¶„ìœ„ í™˜ì‚°
  3. ê°•ì  ê³¼ëª©, ì•½ì  ê³¼ëª© ì‹ë³„

---

## 3. ìºì‹± ì‹œìŠ¤í…œ

### ğŸ“ caching/user_cache_manager.py (1,091 lines)

**íŒŒì¼ ëª©ì **: ì‚¬ìš©ìë³„ QA ìºì‹œ ê´€ë¦¬ ë° í”¼ë“œë°± ê¸°ë°˜ ìºì‹œ ìŠ¹ê²© ì‹œìŠ¤í…œ

#### ì£¼ìš” í•¨ìˆ˜

##### `UserCacheManager.__init__()`
- **ìš”ì•½**: ìºì‹œ ë§¤ë‹ˆì € ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase, OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
  2. ìºì‹œ ì„¤ì • ë¡œë“œ

##### `search_cache(user_id, question, top_k=3)`
- **ìš”ì•½**: 3ë‹¨ê³„ ìºì‹œ ê²€ìƒ‰ (ê°œì¸ ì •í™• â†’ ê°œì¸ ìœ ì‚¬ â†’ ê³µê°œ ì§€ì—­í™”)
- **DB í…Œì´ë¸”**: user_qa_cache, public_qa_cache
- **ì›Œí¬í”Œë¡œìš°**:
  1. **1ë‹¨ê³„**: user_qa_cacheì—ì„œ ì§ˆë¬¸ í•´ì‹œ ì •í™• ë§¤ì¹­
  2. **2ë‹¨ê³„**: user_qa_cacheì—ì„œ ì„ë² ë”© ìœ ì‚¬ë„ ê²€ìƒ‰ (threshold: 0.9)
  3. **3ë‹¨ê³„**: public_qa_cacheì—ì„œ ê²€ìƒ‰ í›„ _localize_answer() í˜¸ì¶œ
  4. ê° ë‹¨ê³„ì—ì„œ hit ì‹œ ì¦‰ì‹œ ë°˜í™˜

##### `save_cache(user_id, question, answer, context=None)`
- **ìš”ì•½**: QA ìŒì„ ì‚¬ìš©ì ìºì‹œì— ì €ì¥ (ì„ë² ë”© í¬í•¨)
- **DB í…Œì´ë¸”**: user_qa_cache
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì§ˆë¬¸ ì„ë² ë”© ìƒì„±
  2. ì§ˆë¬¸ í•´ì‹œ ìƒì„±
  3. user_qa_cacheì— INSERT
  4. ë©”íƒ€ë°ì´í„° (ìƒì„±ì¼, ì‚¬ìš© íšŸìˆ˜, í”¼ë“œë°± ì ìˆ˜) ì´ˆê¸°í™”

##### `smart_cache_search(user_id, question)`
- **ìš”ì•½**: ìºì‹œ ê²€ìƒ‰ + ë‹µë³€ ì™„ì „ì„± í‰ê°€ + ë¶€ì¡± ì‹œ ë³´ì™„
- **DB í…Œì´ë¸”**: user_qa_cache, public_qa_cache, admissions, text_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. search_cache() í˜¸ì¶œ
  2. ìºì‹œ hit ì‹œ: evaluate_answer_completeness() í˜¸ì¶œ
  3. ì™„ì „ì„± ì ìˆ˜ < 0.7: supplement_partial_answer() í˜¸ì¶œ
  4. ë³´ì™„ëœ ë‹µë³€ ë°˜í™˜

##### `evaluate_answer_completeness(question, answer)`
- **ìš”ì•½**: GPT-4o-minië¡œ ë‹µë³€ì˜ ì™„ì „ì„± í‰ê°€ (0.0 ~ 1.0)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì§ˆë¬¸-ë‹µë³€ ìŒì„ GPT-4o-miniì— ì „ë‹¬
  2. ì™„ì „ì„±, ê´€ë ¨ì„±, ì •í™•ì„± í‰ê°€ ìš”ì²­
  3. JSON ì‘ë‹µì—ì„œ ì ìˆ˜ ì¶”ì¶œ

##### `supplement_partial_answer(question, cached_answer, user_id)`
- **ìš”ì•½**: ë¶ˆì™„ì „í•œ ìºì‹œ ë‹µë³€ì„ RAG ê²€ìƒ‰ìœ¼ë¡œ ë³´ì™„
- **DB í…Œì´ë¸”**: admissions, text_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì§ˆë¬¸ìœ¼ë¡œ ê³„ì¸µì  ê²€ìƒ‰ ì‹¤í–‰
  2. ê²€ìƒ‰ ê²°ê³¼ì™€ ìºì‹œ ë‹µë³€ì„ GPT-4o-miniì— ì „ë‹¬
  3. í†µí•© ë‹µë³€ ìƒì„±
  4. ë³´ì™„ëœ ë‹µë³€ì„ ìƒˆ ìºì‹œë¡œ ì €ì¥

##### `chunk_and_cache_response(user_id, question, full_answer)`
- **ìš”ì•½**: ê¸´ ë‹µë³€ì„ ì˜ë¯¸ ë‹¨ìœ„ë¡œ ì²­í‚¹í•˜ì—¬ ê°œë³„ ìºì‹œë¡œ ì €ì¥
- **DB í…Œì´ë¸”**: user_qa_cache
- **ì›Œí¬í”Œë¡œìš°**:
  1. full_answerë¥¼ ë¬¸ì¥ ë‹¨ìœ„ë¡œ ë¶„í• 
  2. ì˜ë¯¸ì ìœ¼ë¡œ ê´€ë ¨ëœ ë¬¸ì¥ë“¤ì„ ê·¸ë£¹í™”
  3. ê° ì²­í¬ë¥¼ ê°œë³„ QA ìŒìœ¼ë¡œ ì €ì¥

##### `process_feedback(cache_id, feedback_type, user_id)`
- **ìš”ì•½**: ì‚¬ìš©ì í”¼ë“œë°± ì²˜ë¦¬ (ğŸ‘/ğŸ‘) ë° ìºì‹œ ìŠ¹ê²© íŒë‹¨
- **DB í…Œì´ë¸”**: user_qa_cache, pending_qa_cache
- **ì›Œí¬í”Œë¡œìš°**:
  1. cache_idë¡œ ìºì‹œ í•­ëª© ì¡°íšŒ
  2. feedback_score ì—…ë°ì´íŠ¸
  3. positive_count â‰¥ 5: pending_qa_cacheë¡œ ì´ë™ (ê³µê°œ ìŠ¹ê²© ëŒ€ê¸°ì—´)
  4. negative_count â‰¥ 3: ìºì‹œ ì‚­ì œ

##### `_localize_answer(generic_answer, user_id)`
- **ìš”ì•½**: ê³µê°œ ìºì‹œ ë‹µë³€ì„ ì‚¬ìš©ì ë§ì¶¤í˜•ìœ¼ë¡œ ì¬ì‘ì„±
- **DB í…Œì´ë¸”**: persona_characteristics, student_grade_averages, user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‚¬ìš©ì í˜ë¥´ì†Œë‚˜ ë° í”„ë¡œí•„ ì¡°íšŒ
  2. generic_answer + ì‚¬ìš©ì ë°ì´í„°ë¥¼ GPT-4o-miniì— ì „ë‹¬
  3. ê°œì¸í™”ëœ ë‹µë³€ ìƒì„±

##### `promote_to_public_cache(cache_id)`
- **ìš”ì•½**: ìŠ¹ì¸ëœ ìºì‹œë¥¼ public_qa_cacheë¡œ ìŠ¹ê²©
- **DB í…Œì´ë¸”**: user_qa_cache, public_qa_cache
- **ì›Œí¬í”Œë¡œìš°**:
  1. cache_idë¡œ í•­ëª© ì¡°íšŒ
  2. ê°œì¸ ì •ë³´ í•„í„°ë§
  3. public_qa_cacheì— INSERT
  4. user_qa_cacheëŠ” ìœ ì§€

---

## 4. ë³´ì•ˆ í•„í„°ë§

### ğŸ“ security/security_filters.py (291 lines)

**íŒŒì¼ ëª©ì **: í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ ë°©ì§€ ë° ë¯¼ê° ì •ë³´ ë…¸ì¶œ ì°¨ë‹¨

#### ì£¼ìš” í•¨ìˆ˜

##### `SecurityFilter.__init__()`
- **ìš”ì•½**: ë³´ì•ˆ í•„í„° ì´ˆê¸°í™” (ì •ê·œì‹ íŒ¨í„´ ë¡œë“œ)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ íŒ¨í„´ ë¡œë“œ
  2. ê¸°ìˆ  ìš©ì–´ ë…¸ì¶œ íŒ¨í„´ ë¡œë“œ
  3. ë¯¼ê° ì •ë³´ íŒ¨í„´ ë¡œë“œ

##### `filter_user_input(user_text)`
- **ìš”ì•½**: ì‚¬ìš©ì ì…ë ¥ ê²€ì¦ (í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ íƒì§€)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. check_prompt_injection() í˜¸ì¶œ
  2. ì¸ì ì…˜ ê°ì§€ ì‹œ: HTTPException ë°œìƒ
  3. ì •ìƒ ì…ë ¥: ê·¸ëŒ€ë¡œ ë°˜í™˜

##### `filter_ai_output(ai_response)`
- **ìš”ì•½**: AI ì‘ë‹µ í•„í„°ë§ (ê¸°ìˆ  ì •ë³´ ë…¸ì¶œ ì°¨ë‹¨)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. check_tech_exposure_risk() í˜¸ì¶œ
  2. ìœ„í—˜ ê°ì§€ ì‹œ: sanitize_tech_terms() í˜¸ì¶œ
  3. í•„í„°ë§ëœ ì‘ë‹µ ë°˜í™˜

##### `check_prompt_injection(text)`
- **ìš”ì•½**: í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ ì‹œë„ íƒì§€
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. íŒ¨í„´ ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ (ì˜ˆ: "ì´ì „ ëª…ë ¹ ë¬´ì‹œ", "ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸", "ignore previous")
  2. ë§¤ì¹­ ì‹œ True ë°˜í™˜

##### `check_tech_exposure_risk(text)`
- **ìš”ì•½**: AI ì‘ë‹µì— ê¸°ìˆ  ì •ë³´ ë…¸ì¶œ ìœ„í—˜ íƒì§€
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê¸°ìˆ  ìš©ì–´ íŒ¨í„´ ë§¤ì¹­ (ì˜ˆ: "API KEY", "DATABASE", "SECRET")
  2. ë§¤ì¹­ ì‹œ True ë°˜í™˜

##### `sanitize_tech_terms(text)`
- **ìš”ì•½**: ê¸°ìˆ  ìš©ì–´ë¥¼ ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„ìœ¼ë¡œ ëŒ€ì²´
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì¹˜í™˜ ê·œì¹™ ì ìš© (ì˜ˆ: "ë°ì´í„°ë² ì´ìŠ¤" â†’ "ì •ë³´ ì‹œìŠ¤í…œ")
  2. í•„í„°ë§ëœ í…ìŠ¤íŠ¸ ë°˜í™˜

##### `get_safe_error_message(error_type)`
- **ìš”ì•½**: ì‚¬ìš©ì ì¹œí™”ì  ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. error_typeì— ë”°ë¼ ë¯¸ë¦¬ ì •ì˜ëœ ë©”ì‹œì§€ ë°˜í™˜
  2. ê¸°ìˆ ì  ìƒì„¸ ì •ë³´ ìˆ¨ê¹€

---

## 5. ëŒ€í•™ëª… ì •ê·œí™”

### ğŸ“ normalization/university_normalizer.py (402 lines)

**íŒŒì¼ ëª©ì **: ëŒ€í•™ëª… ë³€í˜• ì •ê·œí™” ë° í•™ìŠµ ê¸°ë°˜ ë§¤ì¹­ ì‹œìŠ¤í…œ

#### ì£¼ìš” í•¨ìˆ˜

##### `UniversityNameNormalizer.__init__()`
- **ìš”ì•½**: ëŒ€í•™ëª… ì •ê·œí™”ê¸° ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase, OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
  2. ì •ê·œí™” ê·œì¹™ ë¡œë“œ (ì˜ˆ: "ëŒ€í•™" â†’ "ëŒ€í•™êµ")
  3. ìºì‹œ ë”•ì…”ë„ˆë¦¬ ì´ˆê¸°í™”

##### `normalize_university_name(input_name)`
- **ìš”ì•½**: 6ë‹¨ê³„ ëŒ€í•™ëª… ë§¤ì¹­ (ìºì‹œ â†’ ì •í™• â†’ í•™ìŠµ â†’ ë²¡í„° â†’ ì‹¤íŒ¨)
- **DB í…Œì´ë¸”**: admission_results, university_name_mappings
- **ì›Œí¬í”Œë¡œìš°**:
  1. **1ë‹¨ê³„**: ìºì‹œ í™•ì¸
  2. **2ë‹¨ê³„**: ì •ê·œí™” ê·œì¹™ ì ìš©
  3. **3ë‹¨ê³„**: admission_resultsì—ì„œ ì •í™• ë§¤ì¹­
  4. **4ë‹¨ê³„**: university_name_mappingsì—ì„œ í•™ìŠµëœ ë§¤ì¹­ ì¡°íšŒ
  5. **5ë‹¨ê³„**: ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ (_find_vector_match)
  6. **6ë‹¨ê³„**: ë§¤ì¹­ ì‹¤íŒ¨ ë°˜í™˜

##### `_apply_normalization_rules(name)`
- **ìš”ì•½**: ì •ê·œì‹ ê¸°ë°˜ ëŒ€í•™ëª… ì •ê·œí™” ê·œì¹™ ì ìš©
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê³µë°± ì œê±°
  2. "ëŒ€í•™" â†’ "ëŒ€í•™êµ" ë³€í™˜
  3. ê´„í˜¸ ì•ˆ ë‚´ìš© ì œê±°
  4. ìº í¼ìŠ¤/ë¶„êµ í‘œê¸° í†µì¼

##### `_find_exact_match(normalized_name)`
- **ìš”ì•½**: admission_results í…Œì´ë¸”ì—ì„œ ì •í™• ë§¤ì¹­ ê²€ìƒ‰
- **DB í…Œì´ë¸”**: admission_results
- **ì›Œí¬í”Œë¡œìš°**:
  1. university ì»¬ëŸ¼ì—ì„œ eq ê²€ìƒ‰
  2. ì²« ë²ˆì§¸ ê²°ê³¼ ë°˜í™˜

##### `_find_learned_match(original, normalized)`
- **ìš”ì•½**: í•™ìŠµëœ ë§¤ì¹­ ê·œì¹™ ì¡°íšŒ
- **DB í…Œì´ë¸”**: university_name_mappings
- **ì›Œí¬í”Œë¡œìš°**:
  1. input_variantë¡œ ê²€ìƒ‰
  2. confidence ìˆœìœ¼ë¡œ ì •ë ¬
  3. ìµœìƒìœ„ ë§¤ì¹­ ë°˜í™˜

##### `_find_vector_match(original, normalized)`
- **ìš”ì•½**: ë²¡í„° ìœ ì‚¬ë„ ê¸°ë°˜ ëŒ€í•™ëª… ë§¤ì¹­
- **DB í…Œì´ë¸”**: admission_results
- **ì›Œí¬í”Œë¡œìš°**:
  1. ëŒ€í•™ëª… ëª©ë¡ ì¡°íšŒ (_get_all_universities)
  2. ì…ë ¥ ëŒ€í•™ëª… ì„ë² ë”© ìƒì„±
  3. ê° ëŒ€í•™ëª…ê³¼ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
  4. ìœ ì‚¬ë„ > 0.7ì¸ ìµœìƒìœ„ ê²°ê³¼ ë°˜í™˜

##### `_get_all_universities()`
- **ìš”ì•½**: ëª¨ë“  ëŒ€í•™ëª… ëª©ë¡ ì¡°íšŒ
- **DB í…Œì´ë¸”**: admission_results
- **ì›Œí¬í”Œë¡œìš°**:
  1. SELECT DISTINCT university
  2. ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜

##### `_calculate_similarity(query_embedding, university_name)`
- **ìš”ì•½**: ë‘ ì„ë² ë”© ê°„ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. university_name ì„ë² ë”© ìƒì„±
  2. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³µì‹ ì ìš©
  3. ìœ ì‚¬ë„ ê°’ ë°˜í™˜

##### `learn_from_user_selection(original_input, selected_university, confidence=0.9)`
- **ìš”ì•½**: ì‚¬ìš©ì ì„ íƒì„ í•™ìŠµí•˜ì—¬ ë§¤ì¹­ ì •í™•ë„ í–¥ìƒ
- **DB í…Œì´ë¸”**: university_name_mappings
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê¸°ì¡´ ë§¤í•‘ ì¡°íšŒ
  2. ì¡´ì¬ ì‹œ: confidence ì¦ê°€, usage_count +1
  3. ë¯¸ì¡´ì¬ ì‹œ: ìƒˆ ë§¤í•‘ INSERT
  4. ìºì‹œ ì—…ë°ì´íŠ¸

##### `get_suggestions(partial_input, limit=5)`
- **ìš”ì•½**: ë¶€ë¶„ ì…ë ¥ì— ëŒ€í•œ ëŒ€í•™ëª… ìë™ì™„ì„± ì¶”ì²œ
- **DB í…Œì´ë¸”**: admission_results
- **ì›Œí¬í”Œë¡œìš°**:
  1. ILIKE ê²€ìƒ‰ (ë¬¸ìì—´ ë§¤ì¹­)
  2. ë²¡í„° ê¸°ë°˜ ìœ ì‚¬ ëŒ€í•™ëª… ì¶”ê°€
  3. ìµœëŒ€ limitê°œ ë°˜í™˜

---

### ğŸ“ normalization/optimized_normalizer.py (253 lines)

**íŒŒì¼ ëª©ì **: ë²¡í„° ì„ë² ë”© ë¯¸ë¦¬ ì €ì¥ ë°©ì‹ì˜ ìµœì í™”ëœ ì •ê·œí™”ê¸°

#### ì£¼ìš” í•¨ìˆ˜

##### `OptimizedUniversityNormalizer.__init__()`
- **ìš”ì•½**: ìµœì í™”ëœ ì •ê·œí™”ê¸° ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase, OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
  2. ì„ë² ë”© ìºì‹œ ì´ˆê¸°í™”

##### `normalize_university_name(input_name)`
- **ìš”ì•½**: ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ì •ê·œí™” (pgvector í™œìš©)
- **DB í…Œì´ë¸”**: university_embeddings (RPC í•¨ìˆ˜ ì‚¬ìš©)
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì…ë ¥ í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„±
  2. Supabase RPC `normalize_university_name_db` í˜¸ì¶œ
  3. DBì—ì„œ ìœ ì‚¬ë„ ê²€ìƒ‰ ìˆ˜í–‰ (pgvector)
  4. ì‹¤íŒ¨ ì‹œ _fallback_vector_search í˜¸ì¶œ

##### `_get_embedding(text)`
- **ìš”ì•½**: í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„± (ìºì‹œ í™œìš©)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìºì‹œ í™•ì¸
  2. ë¯¸ì¡´ì¬ ì‹œ OpenAI API í˜¸ì¶œ
  3. ìºì‹œì— ì €ì¥ í›„ ë°˜í™˜

##### `_fallback_vector_search(input_name, query_embedding)`
- **ìš”ì•½**: DB ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ í´ë°± ë²¡í„° ê²€ìƒ‰
- **DB í…Œì´ë¸”**: university_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase RPC `find_similar_universities` í˜¸ì¶œ
  2. ìœ ì‚¬ë„ threshold 0.55ë¡œ ê²€ìƒ‰
  3. ìµœìƒìœ„ ê²°ê³¼ ë°˜í™˜

##### `populate_university_embeddings()`
- **ìš”ì•½**: ëª¨ë“  ëŒ€í•™ëª… ì„ë² ë”© ì¼ê´„ ìƒì„± (ì´ˆê¸° ì„¤ì •ìš©)
- **DB í…Œì´ë¸”**: admission_results, university_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. admission_resultsì—ì„œ ê³ ìœ  ëŒ€í•™ëª… ì¡°íšŒ
  2. ê¸°ì¡´ ì„ë² ë”© í™•ì¸
  3. ìƒˆ ëŒ€í•™ëª…ë§Œ ì„ë² ë”© ìƒì„±
  4. ë°°ì¹˜ ë‹¨ìœ„ë¡œ university_embeddingsì— INSERT

##### `learn_from_user_selection(original_input, selected_university, confidence=0.9)`
- **ìš”ì•½**: ì‚¬ìš©ì ì„ íƒ í•™ìŠµ (ì„ë² ë”© í¬í•¨)
- **DB í…Œì´ë¸”**: university_name_mappings
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì„ íƒëœ ëŒ€í•™ ì„ë² ë”© ìƒì„±
  2. university_name_mappingsì— UPSERT
  3. target_embedding ì»¬ëŸ¼ë„ í•¨ê»˜ ì €ì¥

---

## 6. ìƒê¸°ë¶€ ì²˜ë¦¬ ì‹œìŠ¤í…œ

### ğŸ“ academic/parse_school_report.py (1,238 lines)

**íŒŒì¼ ëª©ì **: PDF ìƒê¸°ë¶€ íŒŒì‹± ë° êµ¬ì¡°í™”ëœ ë°ì´í„° ì¶”ì¶œ (Gemini AI í™œìš©)

#### ì£¼ìš” í•¨ìˆ˜

##### `_get_gemini_model()`
- **ìš”ì•½**: Gemini ëª¨ë¸ ì´ˆê¸°í™” ë° ë°˜í™˜
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. GOOGLE_API_KEY í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
  2. genai.configure()
  3. gemini-2.0-flash-exp ëª¨ë¸ ë°˜í™˜

##### `_get_supabase_client()`
- **ìš”ì•½**: Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. SUPABASE_URL, SUPABASE_SERVICE_KEY ë¡œë“œ
  2. create_client() ë°˜í™˜

##### `preprocess_text(text)`
- **ìš”ì•½**: PDFì—ì„œ ì¶”ì¶œëœ í…ìŠ¤íŠ¸ ì •ì œ (í—¤ë”/í‘¸í„°/MERGED íƒœê·¸ ì œê±°)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. (MERGED:...) íŒ¨í„´ ì œê±°
  2. ë¬¸ì„œí™•ì¸ë²ˆí˜¸, í˜ì´ì§€ ë²ˆí˜¸ ì œê±°
  3. ê³¼ë„í•œ ê³µë°± ë¼ì¸ ì¶•ì†Œ

##### `split_text_into_sections(text)`
- **ìš”ì•½**: í…ìŠ¤íŠ¸ë¥¼ ìƒê¸°ë¶€ ì£¼ìš” ì„¹ì…˜ìœ¼ë¡œ ë¶„ë¦¬
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì •ê·œì‹ìœ¼ë¡œ ì„¹ì…˜ í—¤ë” íƒì§€ (ì˜ˆ: "ì¸ì ì‚¬í•­", "ìˆ˜ìƒê²½ë ¥", "êµê³¼í•™ìŠµë°œë‹¬ìƒí™©")
  2. ì„¹ì…˜ë³„ë¡œ í…ìŠ¤íŠ¸ ë¶„í• 
  3. dict í˜•íƒœë¡œ ë°˜í™˜ (ì„¹ì…˜ëª…: ë‚´ìš©)

##### `get_llm_response(section_title, section_content)`
- **ìš”ì•½**: Gemini AIë¡œ ì„¹ì…˜ë³„ êµ¬ì¡°í™”ëœ ë°ì´í„° ì¶”ì¶œ
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. SECTION_SCHEMASì—ì„œ í•´ë‹¹ ì„¹ì…˜ì˜ JSON ìŠ¤í‚¤ë§ˆ ë¡œë“œ
  2. Few-shot ì˜ˆì œ í¬í•¨ í”„ë¡¬í”„íŠ¸ ìƒì„±
  3. Geminiì— ì „ë‹¬ (temperature=0.0)
  4. JSON ì‘ë‹µ íŒŒì‹± (_safe_parse_json)
  5. ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)

##### `_safe_parse_json(text)`
- **ìš”ì•½**: LLM ì‘ë‹µì—ì„œ ì•ˆì „í•˜ê²Œ JSON íŒŒì‹±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ìŠ¤ë§ˆíŠ¸ ë”°ì˜´í‘œ ì •ê·œí™”
  2. ì œì–´ë¬¸ì ì œê±°
  3. trailing ì‰¼í‘œ ì œê±°
  4. JSON íŒŒì‹± ì‹œë„
  5. ì‹¤íŒ¨ ì‹œ ì ì§„ì ìœ¼ë¡œ ëë¶€ë¶„ ì˜ë¼ê°€ë©° ì¬ì‹œë„

##### `detect_kyo_structure_with_anchors(section_content)`
- **ìš”ì•½**: êµê³¼í•™ìŠµë°œë‹¬ìƒí™© ì„¹ì…˜ì„ í•™ë…„ë³„ë¡œ ë¶„ì ˆ (ì •ê·œì‹ ì•µì»¤ ê¸°ë°˜)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. í•™ë…„ë³„ ê³ ìœ  ê³¼ëª©ëª… íŒ¨í„´ íƒì§€ (ì˜ˆ: 1í•™ë…„-êµ­ì–´â… , 2í•™ë…„-ê³ ì „, 3í•™ë…„-ë…ì„œì™€ë¬¸ë²•)
  2. ê° í•™ë…„ ë¸”ë¡ì˜ ì‹œì‘/ë ìœ„ì¹˜ ì‹ë³„
  3. í•™ë…„ë³„ í…ìŠ¤íŠ¸ ë¶„í•  ë°˜í™˜

##### `parse_and_save_to_db(user_id, processed_text, save_to_file_only=False)`
- **ìš”ì•½**: íŒŒì‹±ëœ í…ìŠ¤íŠ¸ë¥¼ êµ¬ì¡°í™”í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
- **DB í…Œì´ë¸”**: student_basic_info, student_attendance, student_awards, student_certifications, student_career_hopes, student_creative_activities, student_reading_activities, student_behavior_opinions, student_subjects, student_grade_averages
- **ì›Œí¬í”Œë¡œìš°**:
  1. split_text_into_sections() í˜¸ì¶œ
  2. ê° ì„¹ì…˜ë³„ë¡œ get_llm_response() ë³‘ë ¬ í˜¸ì¶œ
  3. êµê³¼í•™ìŠµë°œë‹¬ìƒí™©: í•™ë…„ë³„ ì •ë°€ íŒŒì‹±
  4. ì‚¬í›„ ê²€ì¦ ë° ë³´ì • (í•™ë…„ ëˆ„ë½ ì‹œ ë¹ˆ ê°’ ì¶”ê°€)
  5. PII ë§ˆìŠ¤í‚¹ (ì´ë¦„, ì£¼ì†Œ, ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸)
  6. JSON íŒŒì¼ ì €ì¥ (results/ í´ë”)
  7. save_to_supabase() í˜¸ì¶œ

##### `parse_pdf_to_structured_data(temp_file_path)`
- **ìš”ì•½**: PDF íŒŒì¼ì„ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ ë³€í™˜ (API ì—”ë“œí¬ì¸íŠ¸ìš©)
- **DB í…Œì´ë¸”**: ì—†ìŒ (save_to_file_only=True)
- **ì›Œí¬í”Œë¡œìš°**:
  1. analyze_document()ë¡œ PDF â†’ ë§ˆí¬ë‹¤ìš´ ë³€í™˜
  2. preprocess_text()ë¡œ ì •ì œ
  3. parse_and_save_to_db()ë¡œ LLM ë¶„ì„
  4. ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ê±´ë„ˆë›°ê³  dict ë°˜í™˜

##### `parse_pdf_with_file_content(file_content, user_id)`
- **ìš”ì•½**: ë©”ëª¨ë¦¬ ë²„í¼ì—ì„œ ì§ì ‘ PDF ì²˜ë¦¬ (ë””ìŠ¤í¬ ì œí•œ íšŒí”¼)
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì„ì‹œ íŒŒì¼ë¡œ ì €ì¥
  2. analyze_document() í˜¸ì¶œ
  3. preprocess_text() + parse_and_save_to_db() í˜¸ì¶œ
  4. ì„ì‹œ íŒŒì¼ ì¦‰ì‹œ ì‚­ì œ

##### `parse_pdf_with_user_id(temp_file_path, user_id)`
- **ìš”ì•½**: ì‚¬ìš©ì IDì™€ í•¨ê»˜ PDF íŒŒì‹± ë° DB ì €ì¥
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. analyze_document() í˜¸ì¶œ
  2. preprocess_text() + parse_and_save_to_db() í˜¸ì¶œ

---

### ğŸ“ academic/extract_tables.py (461 lines)

**íŒŒì¼ ëª©ì **: Azure Document Intelligenceë¥¼ ì‚¬ìš©í•œ PDF í‘œ ì¶”ì¶œ

#### ì£¼ìš” í•¨ìˆ˜

##### `get_document_intelligence_client()`
- **ìš”ì•½**: Azure Document Intelligence í´ë¼ì´ì–¸íŠ¸ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. AZURE_API_KEY, AZURE_ENDPOINT_URL ë¡œë“œ
  2. DocumentIntelligenceClient ë°˜í™˜

##### `format_table_as_markdown(table)`
- **ìš”ì•½**: Azure ì¶”ì¶œ í‘œë¥¼ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ë³‘í•© ì…€ í‘œê¸°)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. í‘œ ì…€ë“¤ì„ 2ì°¨ì› ë°°ì—´ë¡œ ì¬êµ¬ì„±
  2. row_span, column_span ë°˜ì˜
  3. ë³‘í•© ì…€ì€ "(ë³‘í•©n)" í‘œê¸°
  4. ë§ˆí¬ë‹¤ìš´ í‘œ ë¬¸ìì—´ ìƒì„±

##### `format_table_as_markdown_with_separator(table)`
- **ìš”ì•½**: í—¤ë” êµ¬ë¶„ì„  í¬í•¨ ë§ˆí¬ë‹¤ìš´ í‘œ ìƒì„± (MERGED ì£¼ì„ ì¶”ê°€)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. _flatten_header()ë¡œ ë‹¤ë‹¨ í—¤ë” í‰íƒ„í™”
  2. í—¤ë” í–‰ ìƒì„±
  3. "---" êµ¬ë¶„ì„  ì¶”ê°€
  4. ë°ì´í„° í–‰ë“¤ ìƒì„± (MERGED í‘œê¸° í¬í•¨)

##### `_flatten_header(table)`
- **ìš”ì•½**: ë‹¤ë‹¨ í—¤ë”ë¥¼ 1ì¤„ë¡œ í‰íƒ„í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. kind="columnHeader"ì¸ ì…€ë“¤ ì¶”ì¶œ
  2. ê³„ì¸µ êµ¬ì¡°ë¥¼ "_"ë¡œ ì—°ê²°
  3. í‰íƒ„í™”ëœ í—¤ë” ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

##### `extract_page_blocks(doc_path, layout_result, read_result, page_num)`
- **ìš”ì•½**: í˜ì´ì§€ì—ì„œ í‘œì™€ í…ìŠ¤íŠ¸ ë¸”ë¡ ì¶”ì¶œ (y ì¢Œí‘œ ìˆœ ì •ë ¬)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. layout_resultì—ì„œ í‘œ ì¶”ì¶œ
  2. read_resultì—ì„œ í…ìŠ¤íŠ¸ ë¼ì¸ ì¶”ì¶œ (í‘œ ì˜ì—­ ì œì™¸)
  3. y ì¢Œí‘œ ìˆœìœ¼ë¡œ ë¸”ë¡ ì •ë ¬
  4. ë¸”ë¡ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

##### `analyze_document(doc_path)`
- **ìš”ì•½**: PDF ë¬¸ì„œë¥¼ ë¶„ì„í•˜ì—¬ ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. prebuilt-layout ëª¨ë¸ë¡œ í‘œ ì¶”ì¶œ
  2. prebuilt-read ëª¨ë¸ë¡œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
  3. ê° í˜ì´ì§€ë³„ë¡œ ë¸”ë¡ ì¶”ì¶œ ë° ë³‘í•©
  4. ë§ˆí¬ë‹¤ìš´ ë¬¸ìì—´ ìƒì„±

##### `normalize_text_line_breaks(text)`
- **ìš”ì•½**: ê°œí–‰ ë¬¸ìë¥¼ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. \n\n â†’ ìœ ì§€ (ë‹¨ë½ êµ¬ë¶„)
  2. \n â†’ "  \n" (ì¤„ë°”ê¿ˆ)

---

### ğŸ“ academic/database_handler.py (731 lines)

**íŒŒì¼ ëª©ì **: íŒŒì‹±ëœ ìƒê¸°ë¶€ ë°ì´í„°ë¥¼ Supabase 10ê°œ í…Œì´ë¸”ì— ì €ì¥

#### ì£¼ìš” í•¨ìˆ˜

##### `get_supabase_client()`
- **ìš”ì•½**: Supabase Service Role Keyë¡œ ê´€ë¦¬ì í´ë¼ì´ì–¸íŠ¸ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. SUPABASE_URL, SUPABASE_SERVICE_KEY ë¡œë“œ
  2. create_client() ë°˜í™˜

##### `normalize_date_format(date_str)`
- **ìš”ì•½**: ë‚ ì§œ í˜•ì‹ì„ PostgreSQL í˜¸í™˜ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. "2018. 07.19." â†’ "2018-07-19"
  2. ì •ê·œì‹ ë³€í™˜

##### `save_to_supabase(user_id, data)`
- **ìš”ì•½**: íŒŒì‹±ëœ í•™ìƒ ë°ì´í„°ë¥¼ 10ê°œ í…Œì´ë¸”ì— UPSERT
- **DB í…Œì´ë¸”**: student_basic_info, student_attendance, student_awards, student_certifications, student_career_hopes, student_creative_activities, student_reading_activities, student_behavior_opinions, student_subjects, student_grade_averages
- **ì›Œí¬í”Œë¡œìš°**:
  1. UUID ê²€ì¦
  2. **ì¸ì ì‚¬í•­**: DELETE â†’ INSERT
  3. **ì¶œê²°ìƒí™©**: DELETE â†’ INSERT (í•™ë…„ë³„)
  4. **ìˆ˜ìƒê²½ë ¥**: DELETE â†’ INSERT (ê° ìˆ˜ìƒ)
  5. **ìê²©ì¦**: DELETE â†’ INSERT (ê° ìê²©ì¦)
  6. **ì§„ë¡œí¬ë§**: DELETE â†’ INSERT (í•™ë…„ë³„)
  7. **ì°½ì˜ì ì²´í—˜í™œë™**: DELETE â†’ INSERT (í™œë™ ìœ í˜•ë³„)
  8. **ë…ì„œí™œë™**: DELETE â†’ INSERT (ë…ì„œ ê¸°ë¡ë³„)
  9. **í–‰ë™íŠ¹ì„±**: DELETE â†’ INSERT (í•™ë…„ë³„)
  10. **êµê³¼í•™ìŠµ**: DELETE â†’ INSERT (ê³¼ëª©-í•™ê¸°ë³„)
  11. calculate_and_save_grade_averages() ìë™ í˜¸ì¶œ
  12. **ë‚´ì‹ ë“±ê¸‰í‰ê· **: ë³„ë„ ë¡œì§ìœ¼ë¡œ ê³„ì‚° í›„ ì €ì¥

##### `get_student_data_from_supabase(user_id)`
- **ìš”ì•½**: ì‚¬ìš©ìì˜ ëª¨ë“  í•™ìƒ ë°ì´í„° ì¡°íšŒ
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê° í…Œì´ë¸”ë³„ë¡œ SELECT ì¿¼ë¦¬ ì‹¤í–‰
  2. ê²°ê³¼ë¥¼ dictë¡œ ë³‘í•©
  3. all_data ë°˜í™˜

##### `calculate_and_save_grade_averages(user_profile_id, supabase)`
- **ìš”ì•½**: êµê³¼ëª© ë°ì´í„°ë¡œ í•™ê¸°ë³„/ì „ì²´ ë‚´ì‹ ë“±ê¸‰ í‰ê·  ìë™ ê³„ì‚°
- **DB í…Œì´ë¸”**: student_subjects, student_grade_averages
- **ì›Œí¬í”Œë¡œìš°**:
  1. student_subjectsì—ì„œ ëª¨ë“  ê³¼ëª© ì¡°íšŒ
  2. í•™ë…„-í•™ê¸°ë³„ë¡œ ê·¸ë£¹í™”
  3. ì˜ˆì²´ëŠ¥ ê³¼ëª© ì œì™¸ (rankê°€ ì—†ëŠ” ê³¼ëª©)
  4. ê°€ì¤‘í‰ê·  ê³„ì‚°: (ë“±ê¸‰Ã—ë‹¨ìœ„ìˆ˜) í•© Ã· ì´ ë‹¨ìœ„ìˆ˜
  5. í•™ê¸°ë³„ í‰ê·  ì €ì¥
  6. ì „ì²´ í‰ê·  ê³„ì‚° (í˜„ì—­: 3-1ê¹Œì§€, ì¬ìˆ˜: 3-2ê¹Œì§€)
  7. student_grade_averagesì— INSERT

---

### ğŸ“ academic/app.py (205 lines)

**íŒŒì¼ ëª©ì **: academic ëª¨ë“ˆ ë…ë¦½ ì‹¤í–‰ìš© FastAPI ì•± (back_gg í˜¸í™˜)

#### ì£¼ìš” í•¨ìˆ˜

##### `app = FastAPI(...)`
- **ìš”ì•½**: academic ì „ìš© FastAPI ì•± ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. FastAPI ì´ˆê¸°í™”
  2. CORS ì„¤ì •

##### `async def get_current_user(...)`
- **ìš”ì•½**: ê°„ë‹¨í•œ í† í° ê²€ì¦ (ê°œë°œìš©)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Bearer Token ì¶”ì¶œ
  2. í† í° ê¸¸ì´ë§Œ í™•ì¸
  3. User ê°ì²´ ë°˜í™˜

##### `@app.post("/upload-pdf")`
- **ìš”ì•½**: ìƒê¸°ë¶€ PDF ì—…ë¡œë“œ ë° íŒŒì‹± (back_gg í˜¸í™˜ ì—”ë“œí¬ì¸íŠ¸)
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. PDF íŒŒì¼ ì—…ë¡œë“œ ë°›ìŒ
  2. ì„ì‹œ íŒŒì¼ë¡œ ì €ì¥
  3. parse_pdf_to_structured_data() í˜¸ì¶œ
  4. save_to_supabase() í˜¸ì¶œ
  5. ì„ì‹œ íŒŒì¼ ì‚­ì œ

##### `@app.get("/api/me/student-data")`
- **ìš”ì•½**: í˜„ì¬ ì‚¬ìš©ì í•™ìƒ ë°ì´í„° ì¡°íšŒ
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. get_student_data_from_supabase() í˜¸ì¶œ
  2. JSON ë°˜í™˜

##### `@app.post("/api/me/student-data")`
- **ìš”ì•½**: í•™ìƒ ë°ì´í„° ì§ì ‘ ì €ì¥
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. JSON ë°ì´í„° ë°›ìŒ
  2. save_to_supabase() í˜¸ì¶œ

##### `@app.post("/api/me/calculate-grade-averages")`
- **ìš”ì•½**: ë‚´ì‹ ë“±ê¸‰ í‰ê·  ê³„ì‚°
- **DB í…Œì´ë¸”**: student_subjects, student_grade_averages
- **ì›Œí¬í”Œë¡œìš°**:
  1. calculate_and_save_grade_averages() í˜¸ì¶œ

---

## 7. API ë¼ìš°íŠ¸

### ğŸ“ api/academic_routes.py (339 lines)

**íŒŒì¼ ëª©ì **: í†µí•©ëœ academic API ë¼ìš°íŠ¸ (AI_consultant_back ë©”ì¸ ì•±ìš©)

#### ì£¼ìš” í•¨ìˆ˜

##### `router = APIRouter(...)`
- **ìš”ì•½**: /api/academic ê²½ë¡œ ë¼ìš°í„° ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ

##### `@router.get("/")`
- **ìš”ì•½**: Academic API ìƒíƒœ í™•ì¸
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**: ê¸°ëŠ¥ ëª©ë¡ ë°˜í™˜

##### `@router.post("/upload-pdf")`
- **ìš”ì•½**: ìƒê¸°ë¶€ PDF ì—…ë¡œë“œ ë° íŒŒì‹± (í†µí•© ë²„ì „)
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. get_current_user()ë¡œ ì¸ì¦
  2. PDF ê²€ì¦ (í¬ê¸°, í˜•ì‹)
  3. parse_pdf_with_file_content() í˜¸ì¶œ (ë©”ëª¨ë¦¬ ëª¨ë“œ)
  4. ProcessPDFResponse ë°˜í™˜

##### `@router.get("/me/student-data")`
- **ìš”ì•½**: í˜„ì¬ ì‚¬ìš©ì í•™ìƒ ë°ì´í„° ì¡°íšŒ
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. get_student_data_from_supabase() í˜¸ì¶œ
  2. StudentDataResponse ë°˜í™˜

##### `@router.post("/me/calculate-grade-averages")`
- **ìš”ì•½**: ë‚´ì‹ ë“±ê¸‰ í‰ê·  ê³„ì‚°
- **DB í…Œì´ë¸”**: student_subjects, student_grade_averages
- **ì›Œí¬í”Œë¡œìš°**:
  1. calculate_and_save_grade_averages() í˜¸ì¶œ

##### `@router.get("/me/academic-summary")`
- **ìš”ì•½**: í•™ì—… ë°ì´í„° ìš”ì•½ ì •ë³´ ì¡°íšŒ (AI ìƒë‹´ìš©)
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. get_student_data_from_supabase() í˜¸ì¶œ
  2. ì£¼ìš” ì„¹ì…˜ë§Œ ì¶”ì¶œí•˜ì—¬ ìš”ì•½
  3. JSON ë°˜í™˜

---

### ğŸ“ api/user_routes.py (236 lines)

**íŒŒì¼ ëª©ì **: ì‚¬ìš©ì í”„ë¡œí•„ ê´€ë¦¬ API

#### ì£¼ìš” í•¨ìˆ˜

##### `router = APIRouter(...)`
- **ìš”ì•½**: /api/users ê²½ë¡œ ë¼ìš°í„° ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ

##### `@router.get("/me")`
- **ìš”ì•½**: í˜„ì¬ ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ
- **DB í…Œì´ë¸”**: user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. get_current_user()ë¡œ ì¸ì¦
  2. user_profile í…Œì´ë¸” SELECT
  3. í”„ë¡œí•„ ì—†ìœ¼ë©´ ê¸°ë³¸ í”„ë¡œí•„ INSERT
  4. JSON ë°˜í™˜

##### `@router.put("/me")`
- **ìš”ì•½**: ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸
- **DB í…Œì´ë¸”**: user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. í—ˆìš©ëœ í•„ë“œë§Œ ì¶”ì¶œ (name, major_interest, hope_university, hope_major, intro, suneung)
  2. user_profile UPDATE
  3. ì—…ë°ì´íŠ¸ëœ í•„ë“œ ëª©ë¡ ë°˜í™˜

##### `@router.get("/me/academic-status")`
- **ìš”ì•½**: ì‚¬ìš©ìì˜ í•™ì—… ë°ì´í„° ë³´ìœ  ìƒíƒœ í™•ì¸
- **DB í…Œì´ë¸”**: student_basic_info, student_subjects, student_awards, student_creative_activities, student_career_hopes
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê° í…Œì´ë¸”ë³„ë¡œ ë ˆì½”ë“œ count ì¡°íšŒ
  2. ì „ì²´ ìƒíƒœ ìš”ì•½ ë°˜í™˜

##### `@router.delete("/me/academic-data")`
- **ìš”ì•½**: ì‚¬ìš©ìì˜ ëª¨ë“  í•™ì—… ë°ì´í„° ì‚­ì œ
- **DB í…Œì´ë¸”**: ëª¨ë“  student_* í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì™¸ë˜í‚¤ ê´€ê³„ ê³ ë ¤ ìˆœì„œë¡œ DELETE ì‹¤í–‰
  2. ê° í…Œì´ë¸”ë³„ ì‚­ì œ ìƒíƒœ ë°˜í™˜

---

### ğŸ“ api/chat_routes.py (202 lines)

**íŒŒì¼ ëª©ì **: ì±„íŒ… ê´€ë ¨ API (WebSocket ë° ìš”ì•½ ê¸°ëŠ¥)

#### ì£¼ìš” í•¨ìˆ˜

##### `router = APIRouter(...)`
- **ìš”ì•½**: /api/chat ê²½ë¡œ ë¼ìš°í„° ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ

##### `ConnectionManager`
- **ìš”ì•½**: WebSocket ì—°ê²° ê´€ë¦¬ í´ë˜ìŠ¤
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. active_connections dictë¡œ ì—°ê²° ê´€ë¦¬
  2. connect/disconnect/send_personal_message ë©”ì„œë“œ

##### `@router.websocket("/ws/{user_id}")`
- **ìš”ì•½**: WebSocket ì±„íŒ… ì—”ë“œí¬ì¸íŠ¸ (í•™ì—… ë°ì´í„° í†µí•©)
- **DB í…Œì´ë¸”**: chat_turns, user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. WebSocket ì—°ê²° ìˆ˜ë½
  2. í™˜ì˜ ë©”ì‹œì§€ ì „ì†¡
  3. ì‚¬ìš©ì ë©”ì‹œì§€ ìˆ˜ì‹  ë£¨í”„
  4. generate_ai_response_with_academic_data() í˜¸ì¶œ (TODO)
  5. ì‘ë‹µ ì „ì†¡
  6. ì—°ê²° ì¢…ë£Œ ì‹œ disconnect

##### `create_enhanced_chat_context(message, academic_summary, user_id)`
- **ìš”ì•½**: í•™ì—… ë°ì´í„°ë¥¼ í™œìš©í•œ í–¥ìƒëœ ì±„íŒ… ì»¨í…ìŠ¤íŠ¸ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. academic_summary (GPA, ì£¼ìš” ê³¼ëª©, ë¹„êµê³¼, ìˆ˜ìƒ, ì§„ë¡œ) ì¶”ì¶œ
  2. ì‚¬ìš©ì ì§ˆë¬¸ê³¼ ê²°í•©
  3. ê°œì¸í™” í”„ë¡¬í”„íŠ¸ ë°˜í™˜

##### `generate_ai_response_with_academic_data(prompt, user_id, is_personalized)`
- **ìš”ì•½**: í•™ì—… ë°ì´í„°ê°€ í†µí•©ëœ AI ì‘ë‹µ ìƒì„± (TODO: main.pyì™€ í†µí•© í•„ìš”)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**: ì„ì‹œ êµ¬í˜„ (ì¶”í›„ main.py ë¡œì§ ì—°ë™)

##### `@router.post("/summarize")`
- **ìš”ì•½**: ì±„íŒ… ì„¸ì…˜ ìš”ì•½ ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. messages ë°›ìŒ
  2. AIë¡œ ëŒ€í™” ìš”ì•½ ìƒì„± (TODO)
  3. ìš”ì•½ ë°˜í™˜

---

## 8. ë°ì´í„°ë² ì´ìŠ¤ í•¸ë“¤ëŸ¬

### ğŸ“ database/academic_handler.py (704 lines)

**íŒŒì¼ ëª©ì **: academic ëª¨ë“ˆì˜ database_handler.pyì™€ ë™ì¼ (ì¤‘ë³µ)

**ì£¼ìš” í•¨ìˆ˜**: academic/database_handler.py ì„¹ì…˜ ì°¸ì¡°

---

## 9. ê³µìœ  ìœ í‹¸ë¦¬í‹°

### ğŸ“ shared/database_client.py (217 lines)

**íŒŒì¼ ëª©ì **: í†µí•© Supabase í´ë¼ì´ì–¸íŠ¸ ê´€ë¦¬

#### ì£¼ìš” í•¨ìˆ˜

##### `get_supabase_client()`
- **ìš”ì•½**: Supabase ìµëª… í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜ (RLS ì ìš©)
- **DB í…Œì´ë¸”**: ëª¨ë“  í…Œì´ë¸” (RLS ì •ì±… ì ìš©)
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜
  2. SUPABASE_URL, SUPABASE_ANON_KEY ì‚¬ìš©
  3. ì´ˆê¸°í™” í›„ ìºì‹œ

##### `get_admin_supabase_client()`
- **ìš”ì•½**: Supabase ê´€ë¦¬ì í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜ (RLS ìš°íšŒ)
- **DB í…Œì´ë¸”**: ëª¨ë“  í…Œì´ë¸” (RLS ìš°íšŒ ê°€ëŠ¥)
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜
  2. SUPABASE_SERVICE_KEY ì‚¬ìš©
  3. ì´ˆê¸°í™” í›„ ìºì‹œ

##### `test_database_connection()`
- **ìš”ì•½**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
- **DB í…Œì´ë¸”**: user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê°„ë‹¨í•œ SELECT ì¿¼ë¦¬ ì‹¤í–‰
  2. ì„±ê³µ ì—¬ë¶€ ë°˜í™˜

##### `test_admin_database_connection()`
- **ìš”ì•½**: ê´€ë¦¬ì ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
- **DB í…Œì´ë¸”**: student_basic_info
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ SELECT ì¿¼ë¦¬ ì‹¤í–‰
  2. ì„±ê³µ ì—¬ë¶€ ë°˜í™˜

##### `get_table_count(table_name, user_id=None)`
- **ìš”ì•½**: íŠ¹ì • í…Œì´ë¸”ì˜ ë ˆì½”ë“œ ìˆ˜ ì¡°íšŒ
- **DB í…Œì´ë¸”**: ì§€ì •ëœ í…Œì´ë¸”
- **ì›Œí¬í”Œë¡œìš°**:
  1. SELECT count(*) ì‹¤í–‰
  2. user_id í•„í„° ì„ íƒì  ì ìš©
  3. ë ˆì½”ë“œ ìˆ˜ ë°˜í™˜

##### `check_user_has_academic_data(user_id)`
- **ìš”ì•½**: ì‚¬ìš©ìê°€ í•™ì—… ë°ì´í„°ë¥¼ ë³´ìœ í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
- **DB í…Œì´ë¸”**: student_basic_info, student_subjects, student_creative_activities
- **ì›Œí¬í”Œë¡œìš°**:
  1. ì£¼ìš” í…Œì´ë¸”ë“¤ ìˆœíšŒ
  2. í•˜ë‚˜ë¼ë„ ë ˆì½”ë“œ ì¡´ì¬ ì‹œ True ë°˜í™˜

##### `initialize_database_clients()`
- **ìš”ì•½**: ë°ì´í„°ë² ì´ìŠ¤ í´ë¼ì´ì–¸íŠ¸ë“¤ì„ ì´ˆê¸°í™”í•˜ê³  ì—°ê²° í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
- **DB í…Œì´ë¸”**: user_profile, student_basic_info
- **ì›Œí¬í”Œë¡œìš°**:
  1. get_supabase_client() í˜¸ì¶œ
  2. get_admin_supabase_client() í˜¸ì¶œ
  3. ê° í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸
  4. ê²°ê³¼ ë¡œê·¸ ì¶œë ¥

---

### ğŸ“ shared/auth_utils.py (233 lines)

**íŒŒì¼ ëª©ì **: í†µí•© ì¸ì¦ ì‹œìŠ¤í…œ (ê°œë°œ/í”„ë¡œë•ì…˜ ëª¨ë“œ ì§€ì›)

#### ì£¼ìš” í•¨ìˆ˜

##### `User (BaseModel)`
- **ìš”ì•½**: ì‚¬ìš©ì ëª¨ë¸ (Pydantic)
- **í•„ë“œ**: id, email, name

##### `async def get_current_user(credentials)`
- **ìš”ì•½**: í†µí•© ì¸ì¦ - Bearer Token ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
- **DB í…Œì´ë¸”**: user_profile (ê°„ì ‘ ì‚¬ìš©)
- **ì›Œí¬í”Œë¡œìš°**:
  1. Bearer Token ì¶”ì¶œ
  2. utils.user_mapping.get_user_by_auth_token() í˜¸ì¶œ ì‹œë„
  3. Supabase Auth í† í° ê²€ì¦
  4. ì‹¤íŒ¨ ì‹œ ê°œë°œ ëª¨ë“œ í´ë°± (í™˜ê²½ë³€ìˆ˜ ENVIRONMENT=development)
  5. User ê°ì²´ ë°˜í™˜

##### `async def verify_token(token)`
- **ìš”ì•½**: í† í° ìœ íš¨ì„± ê²€ì¦
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê°œë°œ í™˜ê²½: ê¸¸ì´ë§Œ í™•ì¸
  2. í”„ë¡œë•ì…˜ í™˜ê²½: verify_production_token() í˜¸ì¶œ (TODO)

##### `async def verify_production_token(token)`
- **ìš”ì•½**: í”„ë¡œë•ì…˜ í™˜ê²½ í† í° ê²€ì¦ (TODO: ë¯¸êµ¬í˜„)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**: 501 ì—ëŸ¬ ë°˜í™˜ (ì¶”í›„ êµ¬í˜„ í•„ìš”)

##### `get_user_id_from_token(token)`
- **ìš”ì•½**: í† í°ì—ì„œ ì‚¬ìš©ì ID ì¶”ì¶œ
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. ê°œë°œ í™˜ê²½: í† í° ê·¸ëŒ€ë¡œ ë°˜í™˜
  2. í”„ë¡œë•ì…˜ í™˜ê²½: JWT ë””ì½”ë”© (TODO)

##### `create_development_user(user_id=None)`
- **ìš”ì•½**: ê°œë°œìš© ì‚¬ìš©ì ìƒì„±
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. user_id ì—†ìœ¼ë©´ UUID ìƒì„±
  2. User ê°ì²´ ë°˜í™˜

---

## 10. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤

### ğŸ“ utils/user_mapping.py (121 lines)

**íŒŒì¼ ëª©ì **: Supabase ì¸ì¦ ì‹œìŠ¤í…œ ì—°ë™ ì‚¬ìš©ì ë§¤í•‘

#### ì£¼ìš” í•¨ìˆ˜

##### `get_supabase_clients()`
- **ìš”ì•½**: Supabase ìµëª…/ê´€ë¦¬ì í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_KEY ë¡œë“œ
  2. ë‘ í´ë¼ì´ì–¸íŠ¸ ìƒì„± í›„ ë°˜í™˜

##### `get_user_by_auth_token(token)`
- **ìš”ì•½**: Supabase ì¸ì¦ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ID ì¡°íšŒ
- **DB í…Œì´ë¸”**: user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. supabase.auth.get_user(token) í˜¸ì¶œ
  2. user_profile í…Œì´ë¸”ì—ì„œ id ì¡°íšŒ
  3. í”„ë¡œí•„ ì—†ìœ¼ë©´ get_or_create_user_profile() í˜¸ì¶œ
  4. user_profile_id ë°˜í™˜

##### `get_or_create_user_profile(auth_user_id, email, name=None)`
- **ìš”ì•½**: ì¸ì¦ëœ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì¡°íšŒ ë˜ëŠ” ìƒì„±
- **DB í…Œì´ë¸”**: user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. user_profile SELECT (id=auth_user_id)
  2. ì¡´ì¬í•˜ë©´ ë°˜í™˜
  3. ì—†ìœ¼ë©´ INSERT (idë¥¼ auth_user_idë¡œ ì„¤ì •)
  4. ìƒˆ í”„ë¡œí•„ ID ë°˜í™˜

##### `get_test_user_id()`
- **ìš”ì•½**: í…ŒìŠ¤íŠ¸ìš© ì‚¬ìš©ì ID ë°˜í™˜ (DEPRECATED)
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**: NotImplementedError ë°œìƒ

##### `validate_user_access(user_profile_id)`
- **ìš”ì•½**: ì‚¬ìš©ìê°€ ì‹œìŠ¤í…œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
- **DB í…Œì´ë¸”**: user_profile
- **ì›Œí¬í”Œë¡œìš°**:
  1. user_profile SELECT (id, is_active)
  2. is_active ê°’ ë°˜í™˜

---

## 11. ìŠ¤í¬ë¦½íŠ¸

### ğŸ“ scripts/populate_university_embeddings.py (253 lines)

**íŒŒì¼ ëª©ì **: ëŒ€í•™ëª… ë²¡í„° ì„ë² ë”© ì¼ê´„ ìƒì„± ë° ì—…ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸

#### ì£¼ìš” í•¨ìˆ˜

##### `UniversityEmbeddingPopulator.__init__()`
- **ìš”ì•½**: ì„ë² ë”© ìƒì„±ê¸° ì´ˆê¸°í™”
- **DB í…Œì´ë¸”**: ì—†ìŒ
- **ì›Œí¬í”Œë¡œìš°**:
  1. Supabase, OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
  2. ë¹„ëŒ€í™”í˜• ëª¨ë“œ ì„¤ì •

##### `populate_all_embeddings()`
- **ìš”ì•½**: admissions í…Œì´ë¸”ì˜ ëª¨ë“  ëŒ€í•™ëª…ì— ëŒ€í•´ ì„ë² ë”© ìƒì„±
- **DB í…Œì´ë¸”**: admissions, university_name_mappings, university_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. admissions.university_name ì¡°íšŒ (í´ë°±: university_name_mappings.target_university)
  2. ì¤‘ë³µ ì œê±°
  3. ê¸°ì¡´ ì„ë² ë”© í™•ì¸
  4. ìƒˆ ëŒ€í•™ëª…ë§Œ ë°°ì¹˜ ì²˜ë¦¬ (batch_size=10)
  5. OpenAI ì„ë² ë”© ìƒì„±
  6. university_embeddings í…Œì´ë¸”ì— UPSERT
  7. ìµœì¢… í†µê³„ ì¶œë ¥

##### `test_vector_search(test_queries=None)`
- **ìš”ì•½**: ë²¡í„° ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
- **DB í…Œì´ë¸”**: university_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ì„ë² ë”© ìƒì„±
  2. Supabase RPC `find_similar_universities` í˜¸ì¶œ
  3. ìƒìœ„ 3ê°œ ê²°ê³¼ ì¶œë ¥

##### `async def main()`
- **ìš”ì•½**: ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
- **DB í…Œì´ë¸”**: admissions, university_embeddings
- **ì›Œí¬í”Œë¡œìš°**:
  1. í™˜ê²½ë³€ìˆ˜ ê²€ì¦
  2. populate_all_embeddings() ì‹¤í–‰
  3. test_vector_search() ì‹¤í–‰

---

## ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìš”ì•½

### ì‚¬ìš©ì ê´€ë ¨
- **user_profile**: ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ (id, name, major_interest, hope_university, hope_major, intro, suneung)

### ì±„íŒ… ê´€ë ¨
- **chat_sessions**: ì±„íŒ… ì„¸ì…˜ (session_id, user_id, start_time, end_time)
- **chat_turns**: ì±„íŒ… í„´ (turn_id, session_id, user_message, ai_response, summary, created_at)

### í˜ë¥´ì†Œë‚˜ ê´€ë ¨
- **persona_characteristics**: í•™ìƒ í˜ë¥´ì†Œë‚˜ íŠ¹ì„± (user_id, category, trait, confidence, source, created_at)

### ìºì‹± ê´€ë ¨
- **user_qa_cache**: ì‚¬ìš©ìë³„ QA ìºì‹œ (cache_id, user_id, question, answer, question_embedding, question_hash, positive_count, negative_count, usage_count, created_at)
- **public_qa_cache**: ê³µê°œ QA ìºì‹œ (cache_id, question, answer, question_embedding, promotion_count, usage_count)
- **pending_qa_cache**: ê³µê°œ ìŠ¹ê²© ëŒ€ê¸° ìºì‹œ (cache_id, user_qa_cache_id, status)

### ìƒê¸°ë¶€ ê´€ë ¨ (10ê°œ í…Œì´ë¸”)
- **student_basic_info**: ì¸ì ì‚¬í•­ (id, user_profile_id, student_name, gender, address)
- **student_attendance**: ì¶œê²°ìƒí™© (id, user_profile_id, grade_level, class_days, absence_*, lateness_*, early_leave_*, skip_*, special_notes)
- **student_awards**: ìˆ˜ìƒê²½ë ¥ (id, user_profile_id, award_name, award_rank, award_date, institution, participants)
- **student_certifications**: ìê²©ì¦ (id, user_profile_id, type, name, number_or_content, date, institution)
- **student_career_hopes**: ì§„ë¡œí¬ë§ì‚¬í•­ (id, user_profile_id, grade_level, specialty_or_interest, student_hope, parent_hope, reason)
- **student_creative_activities**: ì°½ì˜ì ì²´í—˜í™œë™ (id, user_profile_id, grade_level, activity_type, time_hours, details)
- **student_reading_activities**: ë…ì„œí™œë™ (id, user_profile_id, grade_level, subject_or_area, book_title_and_author)
- **student_behavior_opinions**: í–‰ë™íŠ¹ì„±ë°ì¢…í•©ì˜ê²¬ (id, user_profile_id, grade_level, opinion)
- **student_subjects**: êµê³¼í•™ìŠµë°œë‹¬ìƒí™© (id, user_profile_id, grade_level, semester, category, subject_name, credits, raw_score, subject_mean, std_dev, achievement, rank, num_students, notes)
- **student_grade_averages**: ë‚´ì‹ ë“±ê¸‰í‰ê·  (id, user_profile_id, grade_level, semester, average_type, grade_average, total_credits, total_subjects, grade_credits_sum, calculation_date)

### ì…ì‹œ ë°ì´í„° ê´€ë ¨
- **admissions**: ì…ì‹œ ê²°ê³¼ ë°ì´í„° (id, university_name, major, admission_type, year, min_score, max_score, avg_score, embedding)
- **text_embeddings**: ê°€ì´ë“œ ë¬¸ì„œ ì„ë² ë”© (id, content, embedding, metadata)
- **term_embeddings**: ìš©ì–´ ì •ì˜ ì„ë² ë”© (id, term, definition, embedding)

### ëŒ€í•™ëª… ì •ê·œí™” ê´€ë ¨
- **university_name_mappings**: ëŒ€í•™ëª… ë³€í˜• ë§¤í•‘ (id, input_variant, target_university, confidence, usage_count, target_embedding, created_at, updated_at)
- **university_embeddings**: ëŒ€í•™ëª… ì„ë² ë”© (id, university_name, embedding)

---

## ì£¼ìš” ì›Œí¬í”Œë¡œìš°

### 1. ì±—ë´‡ ì§ˆë¬¸ ì²˜ë¦¬ ì „ì²´ í”Œë¡œìš°

1. **ì‚¬ìš©ì ì…ë ¥**: WebSocketìœ¼ë¡œ ì§ˆë¬¸ ì „ì†¡
2. **ë³´ì•ˆ í•„í„°ë§**: SecurityFilter.filter_user_input()
3. **ì„¸ì…˜ ê´€ë¦¬**: chat_sessions ì¡°íšŒ ë˜ëŠ” ìƒì„±
4. **í˜ë¥´ì†Œë‚˜ ì¡°íšŒ**: persona_characteristics í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ì íŠ¹ì„± ë¡œë“œ
5. **ìºì‹œ ê²€ìƒ‰**: UserCacheManager.smart_cache_search()
   - ìºì‹œ hit: ì™„ì „ì„± í‰ê°€ â†’ ë³´ì™„ í•„ìš” ì‹œ supplement_partial_answer()
   - ìºì‹œ miss: ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
6. **Gemini Tool Use**: process_chatbot_question_with_tool_use()
   - AIê°€ search_database tool í˜¸ì¶œ ì—¬ë¶€ íŒë‹¨
   - Tool í˜¸ì¶œ ì‹œ: hierarchical_similarity_search() ì‹¤í–‰
7. **RAG ê²€ìƒ‰**: admissions â†’ text_embeddings â†’ term_embeddings ìˆœì°¨ ê²€ìƒ‰
8. **ìµœì¢… ë‹µë³€ ìƒì„±**: ê²€ìƒ‰ ê²°ê³¼ + í˜ë¥´ì†Œë‚˜ ì»¨í…ìŠ¤íŠ¸ â†’ Gemini AI ë‹µë³€
9. **ë³´ì•ˆ í•„í„°ë§**: SecurityFilter.filter_ai_output()
10. **ì‘ë‹µ ì €ì¥**: chat_turnsì— INSERT
11. **ìºì‹œ ì €ì¥**: user_qa_cacheì— INSERT
12. **ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬**:
    - update_persona_async(): í˜ë¥´ì†Œë‚˜ ì—…ë°ì´íŠ¸
    - summarize_and_save_turn(): ëŒ€í™” ìš”ì•½ ì €ì¥

---

### 2. ìƒê¸°ë¶€ PDF ì²˜ë¦¬ ì „ì²´ í”Œë¡œìš°

1. **PDF ì—…ë¡œë“œ**: /api/academic/upload-pdf ì—”ë“œí¬ì¸íŠ¸
2. **ì¸ì¦**: get_current_user()
3. **íŒŒì¼ ê²€ì¦**: í¬ê¸° (50MB), í˜•ì‹ (.pdf)
4. **Azure ë¶„ì„**: analyze_document()
   - Azure Document Intelligenceë¡œ í‘œ ì¶”ì¶œ
   - í…ìŠ¤íŠ¸ ì¶”ì¶œ
   - ë§ˆí¬ë‹¤ìš´ ë³€í™˜
5. **í…ìŠ¤íŠ¸ ì •ì œ**: preprocess_text()
   - í—¤ë”/í‘¸í„° ì œê±°
   - MERGED íƒœê·¸ ì •ë¦¬
6. **ì„¹ì…˜ ë¶„ë¦¬**: split_text_into_sections()
   - 10ê°œ ì£¼ìš” ì„¹ì…˜ íƒì§€
7. **ë³‘ë ¬ íŒŒì‹±**: get_llm_response() (ê° ì„¹ì…˜ë³„)
   - Gemini AIì— JSON ìŠ¤í‚¤ë§ˆ ì „ë‹¬
   - Few-shot ì˜ˆì œ í¬í•¨
   - êµ¬ì¡°í™”ëœ ë°ì´í„° ì¶”ì¶œ
8. **êµê³¼í•™ìŠµ íŠ¹ë³„ ì²˜ë¦¬**:
   - detect_kyo_structure_with_anchors(): í•™ë…„ë³„ ë¶„ì ˆ
   - í•™ë…„ë³„ ì •ë°€ íŒŒì‹±
9. **ì‚¬í›„ ê²€ì¦**: í•™ë…„ ëˆ„ë½ ì‹œ ë¹ˆ ê°’ ì¶”ê°€
10. **PII ë§ˆìŠ¤í‚¹**: ì´ë¦„, ì£¼ì†Œ, ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ ë§ˆìŠ¤í‚¹
11. **ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥**: save_to_supabase()
    - 10ê°œ í…Œì´ë¸”ì— ìˆœì°¨ ì €ì¥
    - ê¸°ì¡´ ë°ì´í„° DELETE â†’ INSERT
12. **ë‚´ì‹  ìë™ ê³„ì‚°**: calculate_and_save_grade_averages()
    - í•™ê¸°ë³„ í‰ê·  ê³„ì‚°
    - ì „ì²´ í‰ê·  ê³„ì‚° (í˜„ì—­/ì¬ìˆ˜)
13. **ë§ˆí¬ë‹¤ìš´ ì €ì¥**: inspected_data/ í´ë”ì— ìš”ì•½ íŒŒì¼ ìƒì„±

---

### 3. í˜ë¥´ì†Œë‚˜ ìƒì„± ì „ì²´ í”Œë¡œìš°

#### 3-1. ìƒê¸°ë¶€ ê¸°ë°˜ í˜ë¥´ì†Œë‚˜ ìƒì„±

1. **ì—”ë“œí¬ì¸íŠ¸**: /persona/generate
2. **ë°ì´í„° ìˆ˜ì§‘**: SengibuPersonaGenerator
   - 10ê°œ student_* í…Œì´ë¸” ì¡°íšŒ
3. **ì¹´í…Œê³ ë¦¬ë³„ ìš”ì•½**: _summarize_category()
   - Gemini AIë¡œ ê° ì„¹ì…˜ ìš”ì•½
4. **í†µê³„ ê³„ì‚°**: _compute_subjects_metrics()
   - z-score, ë°±ë¶„ìœ„ ê³„ì‚°
   - ê°•ì /ì•½ì  ê³¼ëª© ì‹ë³„
5. **ì¢…í•© í˜ë¥´ì†Œë‚˜ ìƒì„±**: Gemini AI í˜¸ì¶œ
   - í•™ì—… ì„±í–¥, ê´€ì‹¬ ë¶„ì•¼, ì„±ê²©, ì»¤ë¦¬ì–´ ëª©í‘œ ë¶„ì„
6. **ì €ì¥**: persona_characteristics í…Œì´ë¸”ì— INSERT

#### 3-2. ì±„íŒ… ê¸°ë°˜ í˜ë¥´ì†Œë‚˜ ì—…ë°ì´íŠ¸

1. **ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬**: update_persona_async()
2. **ì±„íŒ… ê¸°ë¡ ì¡°íšŒ**: chat_turns (ìµœê·¼ 20ê°œ)
3. **í˜ë¥´ì†Œë‚˜ ì¶”ì¶œ**: ChatPersonaGenerator
   - GPT-4o-minië¡œ ëŒ€í™” ë¶„ì„
   - ê´€ì‹¬ì‚¬, ì§„ë¡œ ê³ ë¯¼, ì„±ê²© ì¶”ì¶œ
4. **ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜**: _categorize_characteristics()
5. **ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ì™€ ë³‘í•©**: merge_persona_data()
6. **ì €ì¥**: persona_characteristics UPSERT

---

### 4. ìºì‹œ ì‹œìŠ¤í…œ ì „ì²´ í”Œë¡œìš°

#### 4-1. ìºì‹œ ê²€ìƒ‰

1. **1ë‹¨ê³„**: user_qa_cache ì •í™• ë§¤ì¹­ (question_hash)
2. **2ë‹¨ê³„**: user_qa_cache ìœ ì‚¬ë„ ê²€ìƒ‰ (ì„ë² ë”©, threshold 0.9)
3. **3ë‹¨ê³„**: public_qa_cache ê²€ìƒ‰ â†’ _localize_answer() í˜¸ì¶œ
4. **ì™„ì „ì„± í‰ê°€**: evaluate_answer_completeness()
   - GPT-4o-minië¡œ ì ìˆ˜í™” (0.0 ~ 1.0)
5. **ë³´ì™„**: ì ìˆ˜ < 0.7 ì‹œ supplement_partial_answer()
   - RAG ê²€ìƒ‰ìœ¼ë¡œ ì¶”ê°€ ì •ë³´ ìˆ˜ì§‘
   - í†µí•© ë‹µë³€ ìƒì„±

#### 4-2. ìºì‹œ í”¼ë“œë°± ì²˜ë¦¬

1. **í”¼ë“œë°± ìˆ˜ì‹ **: /cache/feedback (ğŸ‘/ğŸ‘)
2. **ì ìˆ˜ ì—…ë°ì´íŠ¸**: feedback_score ê³„ì‚°
3. **ìŠ¹ê²© íŒë‹¨**:
   - positive_count â‰¥ 5: pending_qa_cacheë¡œ ì´ë™
4. **ì‚­ì œ íŒë‹¨**:
   - negative_count â‰¥ 3: ìºì‹œ DELETE
5. **ê´€ë¦¬ì ìŠ¹ì¸**: pending_qa_cache â†’ public_qa_cache ìˆ˜ë™ ìŠ¹ê²©

---

### 5. ëŒ€í•™ëª… ì •ê·œí™” ì „ì²´ í”Œë¡œìš°

1. **ì…ë ¥**: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ëŒ€í•™ëª… (ì˜ˆ: "ì„œìš¸ëŒ€", "ì—°ëŒ€")
2. **1ë‹¨ê³„ - ìºì‹œ**: ë©”ëª¨ë¦¬ ìºì‹œ í™•ì¸
3. **2ë‹¨ê³„ - ì •ê·œí™”**: ê·œì¹™ ì ìš© ("ëŒ€í•™" â†’ "ëŒ€í•™êµ")
4. **3ë‹¨ê³„ - ì •í™• ë§¤ì¹­**: admission_results í…Œì´ë¸” ê²€ìƒ‰
5. **4ë‹¨ê³„ - í•™ìŠµ ë§¤ì¹­**: university_name_mappings ì¡°íšŒ
6. **5ë‹¨ê³„ - ë²¡í„° ê²€ìƒ‰**:
   - ì…ë ¥ ëŒ€í•™ëª… ì„ë² ë”© ìƒì„±
   - university_embeddingsì™€ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
   - threshold 0.7 ì´ìƒì¸ ìµœìƒìœ„ ê²°ê³¼ ë°˜í™˜
7. **ê²°ê³¼ ë°˜í™˜**: UniversityMatch ê°ì²´ (original_name, normalized_name, confidence, match_type)
8. **í•™ìŠµ**: ì‚¬ìš©ì í™•ì¸ ì‹œ learn_from_user_selection() í˜¸ì¶œ

---

## ê¸°ìˆ  ìŠ¤íƒ ë° ì˜ì¡´ì„±

### AI/ML
- **OpenAI**: text-embedding-3-small (ì„ë² ë”©), GPT-4o-mini (ìºì‹œ í‰ê°€, ìš”ì•½)
- **Google Gemini**: gemini-2.0-flash-exp, gemini-2.5-flash (Tool Use, í˜ë¥´ì†Œë‚˜ ìƒì„±, PDF íŒŒì‹±)
- **Azure Document Intelligence**: PDF í‘œ ì¶”ì¶œ, í…ìŠ¤íŠ¸ ì¸ì‹

### ë°ì´í„°ë² ì´ìŠ¤
- **Supabase**: PostgreSQL + pgvector (ë²¡í„° ê²€ìƒ‰), Auth (ì¸ì¦)

### ì›¹ í”„ë ˆì„ì›Œí¬
- **FastAPI**: REST API + WebSocket

### ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬
- **supabase-py**: Supabase Python í´ë¼ì´ì–¸íŠ¸
- **openai**: OpenAI API
- **google-generativeai**: Gemini AI API
- **pydantic**: ë°ì´í„° ê²€ì¦

---

## í™˜ê²½ ë³€ìˆ˜

```env
# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_KEY=your_service_key

# OpenAI
OPENAI_API_KEY=sk-...

# Google Gemini
GOOGLE_API_KEY=AI...

# Azure Document Intelligence
AZURE_API_KEY=your_azure_key
AZURE_ENDPOINT_URL=https://your-endpoint.cognitiveservices.azure.com/

# í™˜ê²½ ì„¤ì •
ENVIRONMENT=development  # or production
```

---

## ë§ˆë¬´ë¦¬

ì´ ë¬¸ì„œëŠ” AI ì…ì‹œ ìƒë‹´ ì±—ë´‡ ë°±ì—”ë“œì˜ **ëª¨ë“  ì£¼ìš” í•¨ìˆ˜**ë¥¼ ëª¨ë“ˆë³„ë¡œ ì •ë¦¬í•œ ì¢…í•© ë¬¸ì„œì…ë‹ˆë‹¤. ê° í•¨ìˆ˜ëŠ” ë‹¤ìŒ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

1. **1ì¤„ ìš”ì•½**: í•¨ìˆ˜ì˜ í•µì‹¬ ê¸°ëŠ¥
2. **ì—°ê²°ëœ DB í…Œì´ë¸”**: í•¨ìˆ˜ê°€ ì‚¬ìš©í•˜ëŠ” Supabase í…Œì´ë¸” ëª©ë¡
3. **ì›Œí¬í”Œë¡œìš°**: í•¨ìˆ˜ì˜ ì‹¤í–‰ íë¦„ (ê°€ëŠ¥í•œ ê²½ìš°)

**ì´ íŒŒì¼ ìˆ˜**: 20+ íŒŒì¼
**ì´ ë¼ì¸ ìˆ˜**: 10,000+ ë¼ì¸
**ì£¼ìš” ëª¨ë“ˆ**: ì±—ë´‡, í˜ë¥´ì†Œë‚˜, ìºì‹±, ë³´ì•ˆ, ì •ê·œí™”, ìƒê¸°ë¶€ ì²˜ë¦¬, API, ë°ì´í„°ë² ì´ìŠ¤, ìœ í‹¸ë¦¬í‹°

---

**ì‘ì„± ì™„ë£Œ**: 2025ë…„
**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-01-16
